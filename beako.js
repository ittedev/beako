var u=Symbol.for("Beako Dictionary"),T=Symbol.for("Beako Reactive"),R=Symbol.for("Beako Array"),g=Symbol.for("Beako Lock");function E(e,t,n){if(typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e))){let r=e;if(!r[g])if(n===void 0){C(r);let a=r[u][T][1];typeof t=="function"&&a.add(t);for(let o in r){C(r,o,r[u][T][0]);let s=r[o];typeof s=="object"&&s!==null&&(a.size?a.forEach(i=>{(!(u in s)||!s[u][T][1].has(i))&&E(s,i)}):u in s||E(s))}}else C(r,t,typeof n=="function"?["spy",n]:n)}return e}function C(e,t,n){if(!e[g]){if(!(u in e)){let r=()=>{e[u][T][1].forEach(a=>a())};if(e[u]={[T]:[["bio",r],new Set]},Array.isArray(e)){let a=e[u][R]=e.slice(),o=i=>(r(),i),s=i=>{let l=e[u][R].length;if(e.length<l)for(let p=e.length;p<l;p++)C(e,p);return e.length=l,o(i)};Object.defineProperties(e,{unshift:{get(){return(...i)=>s(Array.prototype.unshift.call(a,...i.map(l=>F(e,l))))}},push:{get(){return(...i)=>s(Array.prototype.push.call(a,...i.map(l=>F(e,l))))}},splice:{get(){return(i,l,...p)=>s(l===void 0?Array.prototype.splice.call(a,i,a.length-i):Array.prototype.splice.apply(a,[i,l,...p.map(h=>F(e,h))]))}},pop:{get(){return()=>s(Array.prototype.pop.call(a))}},shift:{get(){return()=>s(Array.prototype.shift.call(a))}},sort:{get(){return i=>o(i===void 0?Array.prototype.sort.call(a):Array.prototype.sort.call(a,i))}},reverse:{get(){return()=>o(Array.prototype.reverse.call(a))}},copyWithin:{get(){return(i,l,p)=>o(Array.prototype.copyWithin.call(a,i,l!==void 0?l:0,p!==void 0?p:a.length))}}})}}if(t!==void 0)if(!Array.isArray(e)||typeof t!="number"&&isNaN(t)){if(t in e[u]||(e[u][t]=[e[t],new Set],Object.defineProperty(e,t,{get(){return this[u][t][0]},set(r){F(e,r),Ke(this[u][t],r)}})),n){for(let r of e[u][t][1])if(r[1]===n[1])return;e[u][t][1].add(n)}}else{let r=Object.getOwnPropertyDescriptor(e,t);(!r||"value"in r)&&t in e[u][R]&&Object.defineProperty(e,t,{get(){return this[u][R][t]},set(a){F(e,a);let o=this[u][R][t];this[u][R][t]=a,o!==a&&e[u][T][0][1]()},configurable:!0,enumerable:!0})}}}function F(e,t){return e[u][T][1].forEach(n=>E(t,n)),t}function Ke(e,t){let n=e[0];e[0]=t,n!==t&&e[1].forEach(r=>{switch(r[0]){case"bio":r[1]();break;case"bom":e[1].delete(r);case"spy":r[1](t,n);break}})}async function Ue(e,...t){if(typeof e=="object"&&e!==null&&!e[g]){let n=e,r=Array.isArray(t[0])?t.flatMap(o=>o):t,a=await Promise.all(r.map(o=>n[o]===void 0?new Promise(s=>{C(n,o,["bom",s])}):n[o]));return r.reduce((o,s,i)=>(o[s]=a[i],o),{})}return{}}function ie(e,t){return z(e,t,!1,[])}function z(e,t,n,r){if(typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e))&&!r.includes(e)){let a=e;if(!a[g]){r.push(e),a[u]&&a[u][T][1].delete(t);for(let o in a)z(a[o],t,n,r);n&&le(a),r.pop()}}return e}function H(e,t,n){return n===void 0?z(e,t,!0,[]):le(e,t,n),e}function le(e,t,n){if(t!==void 0)u in e&&t in e[u]&&(n?e[u][t][1].forEach(r=>{r[1]===n&&e[u][t][1].delete(r)}):e[u][t][1].clear());else{for(let r in e[u])Object.defineProperty(e,r,{enumerable:!0,configurable:!0,writable:!0,value:e[u][r][0]}),delete e[u][r];Array.isArray(e)&&(delete e.unshift,delete e.push,delete e.splice,delete e.pop,delete e.shift,delete e.sort,delete e.reverse,delete e.copyWithin),delete e[u]}}function D(e,t){return be(e,t,[]),e}function be(e,t,n){if(typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e))){let r=e;if(!r[g]){n.push(e),u in r&&r[u][T][1].add(t);for(let a in r)be(r[a],t,n);n.pop()}}return e}function Je(e,t,n){if(typeof e=="object"&&e!==null){if(!(t in e)&&u in e){let r=e;r[t]=void 0,C(r,t,r[u][T][0])}e[t]=n}return n}function N(e){return e[g]=!0,e}function We(e){return delete e[g],e}var K=Symbol.for("Beako Event Types");var Ee="destroy",xe="patch";K in window||Object.defineProperty(window,K,{value:Object.seal({get destroy(){return Ee},set destroy(e){Ee=e},get patch(){return xe},set patch(e){xe=e}})});var A=window[K];function L(e){let t={el:e};return we(t),t}function qe(e){let t={tag:e.tagName.toLowerCase(),el:e};return Ze(t),we(t),t}function Ze(e){if(e.el.hasAttributes()){let t={};e.el.getAttributeNames().forEach(n=>{if(n.startsWith("on"))return;let r=e.el.getAttribute(n);switch(n){case"class":case"part":return e[n]=r.split(/\s+/);case"style":case"is":return e[n]=r;default:return t[n]=r}}),Object.keys(t).length&&(e.props=t)}}function we(e){if(e.el.hasChildNodes()){let t=e.el.childNodes;e.children=[];for(let n=0;n<t.length;n++)switch(t[n].nodeType){case 1:if(t[n].tagName==="SCRIPT")break;e.children.push(qe(t[n]));break;case 3:e.children.push(t[n].data);break}}}function P(e){if(!e.invalid?.children&&e.el instanceof Node){e.children?.forEach(n=>typeof n=="object"&&P(n));let t=e.el;for(;t.firstChild;)t.removeChild(t.firstChild)}e.el.dispatchEvent(new CustomEvent(A.destroy,{bubbles:!1})),e.invalid?.on||Z(e,{}),!e.invalid?.props&&e.el instanceof Element&&(U(e,{}),J(e,{}),W(e,{}),q(e,{}),Q(e,{}))}function I(e,t){return ce(e,t),e.el.dispatchEvent(new CustomEvent(A.patch,{bubbles:!0,composed:!0})),e}function pe(e,t){return(!e||e.tag!==t.tag||e.is!==t.is||t.new)&&(e=t.is?{tag:t.tag,is:t.is,el:document.createElement(t.tag,{is:t.is})}:{tag:t.tag,el:document.createElement(t.tag)}),U(e,t),J(e,t),W(e,t),q(e,t),Q(e,t),Z(e,t),ce(e,t),"key"in t?e.key=t.key:delete e.key,e}function ve(e,t){return(!e||e.el!==t.el)&&(e={el:t.el},"override"in t&&(e.override=t.override),"invalid"in t&&(e.invalid={...t.invalid})),!e.invalid?.props&&e.el instanceof Element&&(U(e,t),J(e,t),W(e,t),q(e,t),Q(e,t)),e.invalid?.on||Z(e,t),!e.invalid?.children&&e.el instanceof Node&&ce(e,t),e}function U(e,t){let n=(e.class||[]).join(" "),r=(t.class||[]).join(" ");n!==r&&(e.el.className=r),r.length?e.class=(t.class||[]).slice():delete e.class}function J(e,t){let n=e.part||[],r=t.part||[],a=r.filter(s=>!n.includes(s));a.length&&e.el.part.add(...a);let o=n.filter(s=>!r.includes(s));o.length&&e.el.part.remove(...o),r.length?e.part=r.slice():delete e.part}function W(e,t){if(e.el instanceof HTMLElement){let n=e.style||"",r=t.style||"";n!=r&&(e.el.style.cssText=r,r!=""?e.style=r:delete e.style)}}function q(e,t){let n=e.props||{},r=t.props||{},a=Object.keys(n),o=Object.keys(r);o.filter(s=>!a.includes(s)||n[s]!==r[s]).forEach(s=>e.el.setAttribute(s,r[s])),a.filter(s=>!o.includes(s)).forEach(s=>e.el.removeAttribute(s)),o.length?e.props={...r}:delete e.props}function Z(e,t){let n=e.on||{},r=t.on||{},a=Object.keys(n),o=Object.keys(r);o.filter(s=>!a.includes(s)).forEach(s=>{r[s].forEach(i=>{e.el.addEventListener(s,i)})}),a.filter(s=>!o.includes(s)).forEach(s=>{n[s].forEach(i=>{e.el.removeEventListener(s,i)})}),o.filter(s=>a.includes(s)).forEach(s=>{let i=r[s],l=n[s];i.filter(p=>!l.includes(p)).forEach(p=>e.el.addEventListener(s,p)),l.filter(p=>!i.includes(p)).forEach(p=>e.el.removeEventListener(s,p))}),o.length?e.on=o.reduce((s,i)=>(s[i]=[...r[i]],s),{}):delete e.on}function Q(e,t){if(Object.prototype.isPrototypeOf.call(HTMLInputElement.prototype,e.el)){let n=e.el;n.value!==t.props?.value&&(t.props&&"value"in t.props?n.value!==(t.props?.value).toString()&&(n.value=t.props.value):e.el.value!==""&&(e.el.value="")),!n.checked&&t.props&&"checked"in t.props?n.checked=!0:n.checked&&!(t.props&&"checked"in t.props)&&(n.checked=!1)}if(Object.prototype.isPrototypeOf.call(HTMLOptionElement.prototype,e.el)){let n=e.el;!n.selected&&t.props&&"selected"in t.props?n.selected=!0:n.selected&&!(t.props&&"selected"in t.props)&&(n.selected=!1)}}var Ce=class{constructor(){this.stock=new Map}has(t){return this.stock.get(t)?.length}push(t,n){this.stock.has(t)?this.stock.get(t).push(n):this.stock.set(t,[n])}shift(t){return this.stock.get(t).shift()}};function ce(e,t){let n=e.children||[],r=t.children||[];if(n.length===0&&r.length===0||n.length===0&&e.el.hasChildNodes())return;let a=n.length===0&&r.length>1?new DocumentFragment:e.el,o=new Ce,s=0,i=a.firstChild,l=r.filter(m=>typeof m=="number").reverse(),p=l.pop(),h=m=>{let f=pe(null,m);return a.insertBefore(f.el,i||null),f},v=m=>{let f=pe(n[s],m);return f!==n[s]&&(P(n[s]),a.replaceChild(f.el,n[s].el)),i=f.el.nextSibling,s++,f},se=(m=!1)=>{if(typeof n[s]!="number"){if(typeof n[s]=="object"){if(i!==n[s].el){P(n[s++]);return}m&&"key"in n[s]?o.push(n[s].key,n[s]):P(n[s])}let f=i;i=f.nextSibling,a.removeChild(f)}s++},ke=r.map(m=>{switch(typeof m){case"string":return typeof n[s]=="string"?(i.data!==m&&(i.data=m),i=i.nextSibling,s++):a.insertBefore(document.createTextNode(m),i||null),m;case"object":{if("el"in m)if(typeof n[s]=="object"&&m.el===n[s].el){let f=ve(n[s],m);return!f.override&&f.el===i&&f.el instanceof Element&&f.el.getRootNode()===i.getRootNode()&&(i=i.nextSibling),s++,f}else{let f=ve(null,m);return!f.override&&f.el instanceof Element&&f.el.parentNode===null&&a.insertBefore(f.el,i||null),f}if("key"in m)if(o.has(m.key)){let f=pe(o.shift(m.key),m);return a.insertBefore(f.el,i||null),f}else{for(;s<n.length&&n[s]!==p;){if(typeof n[s]=="object"&&m.key===n[s].key)return v(m);se(!0)}return h(m)}else return typeof n[s]=="object"&&!("el"in m)&&!("key"in n[s])?v(m):h(m)}case"number":{for(;s<n.length&&n[s]!==m;)se();return s++,p=l.pop(),o.stock.forEach(f=>f.forEach(De=>P(De))),o.stock.clear(),m}}});for(;s<n.length;)se();ke.length?e.children=ke:delete e.children,n.length===0&&r.length>1&&e.el.append(a)}function y(e,t,n=e.length-1){for(let r=n;r>=0;r--)if(t in e[r])return[e[r][t],r];return[void 0,-1]}var X=class{constructor(t,n,r,a,o){this._key=t;this._value=n;this._index=r;this._entries=a;this._stack=o}get key(){return this._key}get value(){return this._value}get index(){return this._index}get size(){return this._entries.length}get isFirst(){return this._index===0}get isLast(){return this._index===this._entries.length-1}get parent(){return y(this._stack,"loop")[0]}toJSON(){return{key:this._key,value:this._value,_index:this._index,size:this._entries.length,isFirst:this._index===0,isLast:this._index===this._entries.length-1}}};var Y=Symbol.for("Beako Ref");function V(e){return typeof e=="object"&&e!==null&&typeof e.type=="string"}function ue(e){return typeof e=="object"&&e!==null&&e[Y]===!0}function O(e){return"tag"in e}var _=class{constructor(t,n,r=0,a=null){this.text=t;this.field=n;this.index=r;this.token=a}_next(t){let n=["",""];for(this.index=t;this.index<this.text.length;this.index++){let r=Ae(this.field,n[1]+this.text[this.index]);if(r==="other")return n;n[0]=r,n[1]=n[1]+this.text[this.index]}return n}skip(t=[]){t.unshift("other");let n="";if(!this.token)for(let r=this.index;r<this.text.length;r++)if(t.includes(Ae(this.field,this.text[r])))n+=this.text[r];else if(this.token=this._next(r),this.token&&this.token[0]==="partial")n+=this.token[1],this.token=null;else return n;return n}nextIs(t){return this.skip(),this.token?t?this.token[0]===t:this.token[0]:!1}pop(){this.skip();let t=this.token;return this.token=null,t||null}expand(t,n){let r=this.field;this.field=t,n(),this.token&&(this.index-=this.token[1].length,this.token=null),this.field=r}must(t){let n=this.pop();if(!n||n[0]!==t)throw Error(t+" is required.");return n}};function Ae(e,t){switch(e){case"html":switch(t){case">":case"<!--":case"/":return t;case"<":case"</":case"<!":case"<!-":return"partial"}switch(!0){case/^\/\/.*$/.test(t):return"//";case/^<[_\-a-zA-Z][_\-a-zA-Z0-9]*$/.test(t):return"start";case/^<\/[_\-a-zA-Z][_\-a-zA-Z0-9]*$/.test(t):return"end"}break;case"attr":switch(t){case"@if":case"@else":case"@for":case"@each":return"@";case"=":case":=":case"&=":case"*=":return"assign";case">":case"/":case"'":case'"':return t;case":":case"&":case"*":return"partial"}switch(!0){case/^on[_\$\-a-zA-Z0-9]+$/.test(t):return"on";case/^[_\$\-@a-zA-Z0-9]+$/.test(t):return"name"}break;case"comment":switch(t){case"-->":return t;case"-":case"--":return"partial"}break;case"script":switch(t){case"+":case"-":return"multi";case"void":case"typeof":case"~":case"!":return"unary";case"/":case"*":case"%":case"**":case"in":case"instanceof":case"<":case">":case"<=":case">=":case"==":case"!=":case"===":case"!==":case"<<":case">>":case">>>":case"&":case"|":case"^":case"&&":case"||":case"??":return"binary";case"=":case"*=":case"**=":case"/=":case"%=":case"+=":case"-=":case"<<=":case">>=":case">>>=":case"&=":case"^=":case"|=":case"&&=":case"||=":case"??=":return"assign";case"++":case"--":return"crement";case"false":case"true":return"boolean";case"null":case"undefined":case".":case"?.":case"[":case"]":case"{":case"}":case"(":case")":case"...":case"?":case":":case",":case"'":case'"':case"`":return t}switch(!0){case/^\/\/.*$/.test(t):return"//";case/^[_\$a-zA-Z][_\$a-zA-Z0-9]*$/.test(t):return"word";case/^\d+\.?\d*$|^\.?\d+$/.test(t):return"number"}break;case"template":switch(t){case"$":return"partial";case"${":return t;case"}":return t;case"`":return"`";case"\r":case`
`:case`\r
`:return"other"}case"single":case"double":switch(t){case"\\":return"partial";case"\r":case`
`:case`\r
`:return"return";case`\\\r
`:return"escape";case"'":if(e==="single")return t;break;case'"':if(e==="double")return t;break}switch(!0){case/^\\u[0-9a-fA-F]{0,3}$/.test(t):case/^\\x[0-9a-fA-F]{0,1}$/.test(t):case/^\\u\{(0?[0-9a-fA-F]{0,5}|10[0-9a-fA-F]{0,4})$/.test(t):return"partial";case/^\\.$/.test(t):case/^\\u[0-9a-fA-F]{4}$/.test(t):case/^\\u\{(0?[0-9a-fA-F]{1,5}|10[0-9a-fA-F]{1,4})\}$/.test(t):case/^\\x[0-9a-fA-F]{2}$/.test(t):return"escape"}break;case"text":switch(t){case"{":case"}":return"partial";case"{{":case"}}":return t}break}return"other"}function ee(e){switch(e){case"\\n":return`
`;case"\\r":return"\r";case"\\v":return"\v";case"\\t":return"	";case"\\b":return"\b";case"\\f":return"\f"}switch(!0){case/^\\u[0-9a-fA-F]{4}$/.test(e):case/^\\x[0-9a-fA-F]{2}$/.test(e):return String.fromCodePoint(parseInt(e.slice(2),16));case/^\\u\{(0?[0-9a-fA-F]{1,5}|10[0-9a-fA-F]{1,4})\}$/.test(e):return String.fromCodePoint(parseInt(e.slice(3,-1),16))}return e.slice(1)}function d(e){let t=typeof e=="string"?new _(e,"script"):e;return Qe(t)}function Qe(e){let t=Xe(e);if(e.nextIs("assign")){if(t.type!=="get")throw Error("The left operand is not variable");let n=e.pop()[1],r=d(e);return{type:"assign",operator:n,left:t.value,right:r}}else return t}function Xe(e){let t=Le(e);for(;e.nextIs("?");){e.pop();let n=d(e);e.must(":");let r=Le(e);t={type:"if",condition:t,truthy:n,falsy:r}}return t}function Le(e){let t=new Array;for(t.push(te(e));e.nextIs("multi")||e.nextIs("binary");)t.push(e.pop()[1]),t.push(te(e));for(;t.length>1;)for(let n=0;n+1<t.length;n+=2)if(n+3>=t.length||Re(t[n+1])>Re(t[n+3])){let r={type:"binary",operator:t[n+1],left:t[n],right:t[n+2]};t.splice(n,3,r)}return typeof t[0]=="string"?{type:"variable",name:t[0]}:t[0]}function Re(e){switch(e){default:return 0;case"||":case"??":return 4;case"&&":return 5;case"|":return 6;case"^":return 7;case"&":return 8;case"==":case"!=":case"===":case"!==":return 9;case"in":case"instanceof":case"<":case">":case"<=":case">=":return 10;case"<<":case">>":case">>>":return 11;case"+":case"-":return 12;case"*":case"/":case"%":return 13;case"**":return 14}}function te(e){switch(e.nextIs()){case"multi":case"unary":return{type:"unary",operator:e.pop()[1],operand:te(e)};case"crement":return{type:"assign",operator:e.pop()[1].charAt(0)+"=",left:te(e).value,right:{type:"literal",value:1}};default:return Ye(e)}}function Ye(e){let t=et(e);return e.nextIs("crement")?{type:"assign",operator:e.pop()[1].charAt(0)+"=",left:t.value,right:{type:"literal",value:1},prevalue:!0}:t}function et(e){let t=tt(e);for(;;){switch(e.nextIs()){case"(":{e.pop();let n=[];for(;!e.nextIs(")")&&(n.push(d(e)),e.nextIs(","));)e.pop();e.must(")"),t={type:"function",name:t,params:n};continue}case".":{e.pop();let n=e.must("word");t={type:"get",value:{type:"hash",object:t,key:{type:"literal",value:n[1]}}};continue}case"[":{e.pop();let n=d(e);e.must("]"),t={type:"get",value:{type:"hash",object:t,key:n}};continue}}break}return t}function tt(e){let t=e.pop();switch(t[0]){case"word":return{type:"get",value:{type:"variable",name:t[1]}};case"number":return{type:"literal",value:Number(t[1])};case"boolean":return{type:"literal",value:t[1]==="true"};case"undefined":return{type:"literal",value:void 0};case"null":return{type:"literal",value:null};case'"':return j(e,"double",t[0]);case"'":return j(e,"single",t[0]);case"`":return j(e,"template",t[0]);case"(":{let n=d(e);return e.must(")"),n}case"[":{let n=[];for(;!e.nextIs("]");)if(n.push(d(e)),e.nextIs(","))e.pop();else if(e.nextIs("]")){e.pop();break}else throw Error("']' is required");return{type:"array",values:n}}case"{":{let n=[];for(;!e.nextIs("}");){let r=Array(2),a=e.pop();if(a[0]==="word"?r[0]={type:"literal",value:a[1]}:a[0]==='"'?r[0]=j(e,"double",a[0]):a[0]==="'"?r[0]=j(e,"single",a[0]):a[0]==="["&&(r[0]=d(e),e.must("]")),a[0]==="word"&&(e.nextIs(",")||e.nextIs("}"))?r[1]={type:"get",value:{type:"variable",name:a[1]}}:(e.must(":"),r[1]=d(e)),n.push(r),e.nextIs(","))e.pop();else if(e.nextIs("}")){e.pop();break}else throw Error("'}' is required")}return{type:"object",entries:n}}default:throw new Error(t[0]+" is invalid")}}function j(e,t,n){let r=[""],a=0;return e.expand(t,()=>{e:for(;;){r[a]+=e.skip();let o=e.pop();switch(o[0]){case n:break e;case"return":throw Error("Newline cannot be used");case"escape":r[a]+=ee(o[1]);continue;case"${":e.expand("script",()=>{r.push(d(e))}),e.must("}"),r.push(e.skip()),a+=2}}}),a===0?{type:"literal",value:r[0]}:{type:"join",values:r.filter(o=>o!==""),separator:""}}function M(e){switch(e){case"html":case"base":case"head":case"link":case"meta":case"style":case"title":case"body":case"address":case"article":case"aside":case"footer":case"header":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"main":case"nav":case"section":case"blockquote":case"dd":case"div":case"dl":case"dt":case"figcaption":case"figure":case"hr":case"li":case"ol":case"p":case"pre":case"ul":case"a":case"abbr":case"b":case"bdi":case"bdo":case"br":case"cite":case"code":case"data":case"dfn":case"em":case"i":case"kbd":case"mark":case"q":case"rp":case"rt":case"ruby":case"s":case"samp":case"small":case"span":case"strong":case"sub":case"sup":case"time":case"u":case"var":case"wbr":case"area":case"audio":case"img":case"map":case"track":case"video":case"embed":case"iframe":case"object":case"param":case"picture":case"portal":case"source":case"svg":case"math":case"canvas":case"noscript":case"script":case"del":case"ins":case"caption":case"col":case"colgroup":case"table":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":case"button":case"datalist":case"fieldset":case"form":case"input":case"label":case"legend":case"meter":case"optgroup":case"option":case"output":case"progress":case"select":case"textarea":case"details":case"dialog":case"menu":case"summary":case"slot":case"template":return!0}return!1}function Pe(e){switch(e){case"br":case"hr":case"img":case"input":case"meta":case"area":case"base":case"col":case"embed":case"keygen":case"link":case"param":case"source":return!0}return!1}function ne(e){let t=typeof e=="string"?new _(e,"html"):e,n={text:t.skip([">","/"])};for(;t.nextIs("<!--");)t.pop(),t.expand("comment",()=>t.must("-->")),n.text+=t.skip([">","/"]);if(t.nextIs("start")){let r=nt(t);r&&(O(r)?n.next=r:(n.text=r.text,r.next&&(n.next=r.next)))}return n.text?n:n.next?n.next:void 0}function nt(e){let t={tag:e.pop()[1].slice(1).toLocaleLowerCase()},n=rt(e);if(n.length&&(t.attrs=n),e.nextIs("/"))e.pop(),e.must(">");else if(Pe(t.tag))e.must(">");else{e.must(">");let a=ne(e);if(a&&(t.child=a),e.must("end")[1].slice(2)!==t.tag)throw Error(`end tag <${t.tag}> is required.`);e.must(">")}let r=ne(e);return r&&(t.next=r),t.tag==="script"&&t.next?t.next:t}function rt(e){let t=[];return e.expand("attr",()=>{for(e.skip();e.nextIs()&&!e.nextIs(">");){let n=new Array(3);if(e.nextIs("name"))if(n[0]=e.pop()[1],e.nextIs("assign"))n[1]=e.must("assign")[1];else if(e.nextIs("name")||e.nextIs(">")||e.nextIs("/"))n[1]="=",n[2]=n[0];else throw Error("assign is required.");else{if(e.nextIs("on"))n[0]=e.pop()[1],n[1]="on";else if(e.nextIs("@"))n[0]=e.pop()[1],n[1]="@";else break;if(n[0]==="@else")n[2]=n[0];else if(e.must("assign")[1]!=="=")throw Error("= is required.")}n[2]===void 0&&(e.nextIs('"')?n[2]=_e(e,"double",e.pop()[0]):e.nextIs("'")&&(n[2]=_e(e,"single",e.pop()[0]))),t.push(n),e.skip()}}),t}function _e(e,t,n){let r="";return e.expand(t,()=>{e:for(;;){r+=e.skip();let a=e.pop();switch(a[0]){case n:break e;case"return":throw Error("Newline cannot be used");case"escape":r+=ee(a[1]);continue}}}),r}function B(e){let t=ne(e),n=t?fe(t):[];return n.length?{type:"tree",children:n}:{type:"tree"}}var Me=class{constructor(t){this.node=t}isSkippable(t){for(let n=this.node;n;n=n.next){if(O(n))return de(n,t);if(!/^\s*$/.test(n.text))return!1}return!1}skip(){for(;;){if(O(this.node))return this;this.node=this.node.next}}pop(){let t=this.node;return this.node=this.node?.next,t}};function fe(e){let t=new Me(e),n=[];for(;t.node;){let r=at(t);r!==void 0&&n.push(r)}return n}function at(e){if(!e.node)e.pop();else return O(e.node)?Se(e):it(new _(e.pop().text,"text"))}function ot(e){return Se(e)}function Se(e){let t=e.node;if(de(t,"@for")){let n=me(t,"@each")||void 0,r=d(me(t,"@for"));return{type:"for",each:n,array:r,value:Ve(e)}}else return Ve(e)}function Ve(e){let t=e.node;if(de(t,"@if")){let n=d(me(t,"@if")),r=Oe(t);e.pop();let a={type:"if",condition:n,truthy:r};return e.isSkippable("@else")&&(a.falsy=ot(e.skip())),a}else return Oe(e.pop())}function Oe(e){if(e.tag==="group"){let t={type:"group"};if(e.attrs?.forEach(([n,,r])=>{n.match(/^@(if|else|for|each)$/)||n.match(/^@.*$/)&&(t.props||(t.props={}),t.props[n]=r)}),e.child){let n=fe(e.child);n.length&&(t.children=n)}return t}else return st(e)}function st(e){let t={type:"element",tag:e.tag};{let n=[];e.attrs?.forEach(([r,a,o])=>{switch(a){case"=":{switch(r){case"is":{r in t||(t.is=o);return}case"class":case"part":return(t[r]??=[]).push(o.split(/\s+/));case"style":return n.push(o)}return r in(t.props??={})?void 0:t.props[r]=o}case":=":{switch(r){case"is":return t.is=d(o);case"class":case"part":return(t[r]??=[]).push({type:"flags",value:d(o)});case"style":return n.push(d(o))}return(t.props??={})[r]=d(o)}case"*=":{let s=d(o);return V(s)&&s.type==="get"&&(s=s.value),(t.props??={})[r]=s}case"on":{let s=r.slice(2),i={type:"handler",value:d(o)};return((t.on??={})[s]??=[]).push(i)}}}),n.length&&(n.length===1&&typeof n[0]=="string"?t.style=n[0]:t.style={type:"join",values:n.filter(r=>r!==""),separator:";"}),e.attrs?.forEach(([r,a,o])=>{a==="&="&&((t.bools??={})[r]=d(o),t.props&&(delete t.props[r],Object.keys(t.props).length||delete t.props))})}if(e.child){let n=fe(e.child);n.length&&(t.children=n)}return(!M(t.tag)||t.is)&&(t.type="custom"),t}function de(e,t){return e.attrs?.some(n=>n[0]===t)}function me(e,t){let n=e.attrs?.find(r=>r[0]===t);return n?n[2]:""}function it(e){let t=[];for(t.push(e.skip());e.nextIs();)e.nextIs("{{")?(e.pop(),e.expand("script",()=>{t.push({type:"draw",value:d(e)})}),e.must("}}"),t.push(e.skip())):e.pop();return t.length===1&&typeof t[0]=="string"?t[0]:{type:"flat",values:t}}var he=new Array,c=function(e,t=[],n={}){let r=e;switch(r.type){case"literal":return r.value;case"array":return r.values.map(a=>c(a,t,n));case"object":return Object.fromEntries(r.entries.map(a=>a.map(o=>c(o,t))));case"variable":{let[,a]=y(t,r.name);return a>=0?{record:t[a],key:r.name,[Y]:!0}:void 0}case"unary":return pt(r.operator,c(r.operand,t,n));case"binary":{let a=c(r.left,t,n);return Fe(r.operator,a)?He(r.operator,a,c(r.right,t,n)):a}case"assign":{let a=c(r.left,t,n);if(!a)throw Error(r.left?r.left.name:"key is not defined");let{record:o,key:s}=a,i=o[s],l=c(r.right,t,n);if(r.operator.length>1){let p=r.operator.slice(0,-1);Fe(p,i)&&(o[s]=He(p,i,l))}else o[s]=l;return r.prevalue?i:o[s]}case"function":{if(r.name.type==="get"&&r.name.value.type==="hash"){let a=c(r.name.value,t,n);if(!a)throw Error(c(r.name.value.key,t,n)+" is not defined");let o=a.record[a.key];if(typeof o=="function")return o.apply(a.record,r.params.map(s=>c(s,t,n)))}else{let a=c(r.name,t,n);if(typeof a=="function")return a(...r.params.map(o=>c(o,t,n)))}throw Error(r.name.toString()+" is not a function")}case"hash":return{record:c(r.object,t,n),key:c(r.key,t,n),[Y]:!0};case"get":{let a=c(r.value,t,n);return a&&a.record[a.key]}case"flat":{let a=r.values.flatMap(o=>typeof o=="string"?[o]:Te(c(o,t,n))).filter(o=>o!=="").reduce((o,s)=>{let i=o.length;return i&&typeof s=="string"&&typeof o[i-1]=="string"?o[i-1]+=s:o.push(s),o},[]);return a.length===1&&typeof a[0]=="string"?a[0]:a}case"draw":{let a=c(r.value,t,n);if(typeof a=="object")if(V(a))if(a.type==="tree"){a.type="group";let o=c(a,t,n);return a.type="tree",o}else return c(a,t,n);else return Object.getPrototypeOf(a)===Object.prototype?JSON.stringify(a):"";else return a==null?"":a+""}case"join":return r.values.reduce((a,o,s)=>{if(V(o)){let i=c(o,t,n);return a+(s?r.separator:"")+(typeof i=="object"?"":i)}else return a+(s?r.separator:"")+o},"");case"flags":{let a=c(r.value,t,n);if(typeof a=="string")return a.split(/\s+/);if(typeof a=="object"){if(Array.isArray(a))return a;if(a)return Object.keys(a).filter(o=>a[o])}return[]}case"if":return c(r.condition,t,n)?c(r.truthy,t,n):r.falsy?c(r.falsy,t,n):null;case"for":{let a=c(r.array,t,n),o;if(typeof a=="object"&&a!==null)if(Symbol.iterator in a)if("entries"in a)o=[...a.entries()];else{let s=0;o=[];for(let i of a)o.push([s++,i])}else o=Object.entries(a);else o=[[0,a]];return o.flatMap(([s,i],l)=>{let p=new X(s,i,l,o,t),h=Te(c(r.value,t.concat([r.each?{[r.each]:i,loop:p}:{loop:p}]),n)).filter(v=>typeof v!="number");return typeof p.value=="object"&&h.filter(v=>typeof v=="object").forEach(v=>v.key=p.value),h})}case"tree":{let a=re(r,t,n);return a.length?{children:a}:{}}case"custom":{let a=he.find(o=>o.match(r,t,n))?.exec(r,t,n);if(a)return a}case"element":{let a=re(r,t,n),s=a.length?{children:a}:{};return s.tag=r.tag,r.is&&(s.is=typeof r.is=="string"?r.is:c(r.is,t,n)),S(r,t,n,s),s}case"group":return re(r,t,n);case"handler":{n.handler||(n.handler=new WeakMap),n.handler.has(r)||n.handler.set(r,[]);let a=n.handler.get(r);for(let s of a)if(Ne(s[0],t))return s[1];let o=s=>c(r.value,[...t,{event:s}],n);return a.push([t,o]),o}case"evaluation":return c(r.template,r.stack?r.stack.concat(t):t,n);default:return he.find(a=>a.match(e,t,n))?.exec(e,t,n)}};c.plugin=e=>{he.unshift(e)};var lt={match(e,t,n){if(e.type==="custom"){let r=e;if(!M(r.tag))return r.tag==="window"||y(t,r.tag)[0]instanceof EventTarget}return!1},exec(e,t,n){let r=e;if(e.tag==="window"){let s={el:window,override:!0,invalid:{props:!0,children:!0}};return S(r,t,n,s),s}let a=y(t,r.tag)[0],o={el:a};return S(r,t,n,o),a instanceof Element&&r.props&&"@override"in r.props&&(o.override=!0),(a instanceof Element||a instanceof DocumentFragment||a instanceof ShadowRoot)&&r.children&&r.children.length?o.children=re(r,t,n):o.invalid={children:!0},o}};c.plugin(lt);function re(e,t,n){let r=e.children||[],a=0;r.length&&((n.groups??(n.groups=[new WeakMap,0]))[0].has(e)?a=n.groups[0].get(e):(a=n.groups[1]=n.groups[1]+r.length,n.groups[0].set(e,a)));let o=r.flatMap((s,i)=>{if(V(s)){let l=Te(c(s,t,n));switch(s.type){case"if":case"for":case"group":l.push(a-i)}return l}else return[s]});return typeof o[o.length-1]=="number"&&o.pop(),o}function S(e,t,n,r){if(e.style&&(r.style=typeof e.style=="string"?e.style:c(e.style,t,n)),e.bools){for(let a in e.bools)if(!a.startsWith("@")){let o=e.bools[a],s=typeof o=="string"?o:c(o,t,n);s&&((r.props??(r.props={}))[a]=s)}}if(e.props){for(let a in e.props)if(!a.startsWith("@")){let o=e.props[a];(r.props??(r.props={}))[a]=typeof o=="string"?o:c(o,t,n)}}if(e.class&&e.class.forEach(a=>r.class=(r.class||[]).concat(Array.isArray(a)?a:c(a,t,n))),e.part&&e.part.forEach(a=>r.part=(r.part||[]).concat(Array.isArray(a)?a:c(a,t,n))),e.on){r.on||(r.on={});for(let a in e.on)r.on[a]=e.on[a].map(o=>c(o,t,n))}}function Ne(e,t,n=e.length-1,r=t.length-1){let[a,o]=y(e,"loop",n),[s,i]=y(t,"loop",r);return!a&&!s?!0:!a||!s?!1:a.index===s.index&&a.key===s.key&&a.value===s.value&&Ne(e,t,o-1,i-1)}function Te(e){return e==null?[]:Array.isArray(e)?e:[e]}function pt(e,t){switch(e){case"void":return;case"typeof":return typeof t;case"+":return+t;case"-":return-t;case"~":return~t;case"!":return!t;default:throw Error(e+" does not exist")}}function Fe(e,t){switch(e){case"&&":return!!t;case"||":return!t;case"??":return t==null;default:return!0}}function He(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"/":return t/n;case"*":return t*n;case"%":return t%n;case"**":return t**n;case"in":return t in n;case"instanceof":return t instanceof n;case"<":return t<n;case">":return t>n;case"<=":return t<=n;case">=":return t>=n;case"==":return t==n;case"!=":return t!=n;case"===":return t===n;case"!==":return t!==n;case"<<":return t<<n;case">>":return t>>n;case">>>":return t>>>n;case"&":return t&n;case"|":return t|n;case"^":return t^n;case"&&":return t&&n;case"||":return t||n;case"??":return t??n;default:throw Error(e+" does not exist")}}var ye=N({alert,console,Object,Number,Math,Date,Array,JSON,String,isNaN,isFinite,location,history,navigator,setTimeout,setInterval});var $=Symbol.for("Beako Special");function k(e){return typeof e=="object"&&e!==null&&(e.template||e.patcher)&&e.data&&e.options}function ae(e){return typeof e=="object"&&e!==null&&"default"in e&&e[Symbol.toStringTag]==="Module"}function ge(e,t,n={children:[]}){return e.children&&(e.children=e.children.filter(r=>{if(typeof r=="object"){if(t(r))return n.children.push(r),!1;"tag"in r&&ge(r,t,n)}return!0}),e.children.length||delete e.children),n.children.length?n:{}}function oe(...e){let t={children:[]};return e.forEach(n=>{n&&n.children&&(t.children=t.children.concat(n.children))}),t.children.length?t:{}}var x=class{constructor(t,n,r){this._props={};this._refs={};this._requirePatch=!1;let a=r.el;this._component=t,this._template=t.template,this._patcher=t.patcher,this._host=n,this._tree=r,this._updater=new je(r),this.patch=this.patch.bind(this),this.dispatch=this.dispatch.bind(this),this._cache={[$]:[n,a]},this._component.options.mode==="closed"&&a.addEventListener(A.patch,s=>s.stopPropagation()),n.addEventListener(A.destroy,()=>{this.patch({type:"tree"}),ie(this._stack,this.patch)});let o=typeof this._component.data=="function"?this._component.data(this):this._component.data;this._running=(async()=>{let s=await o,i=s?Array.isArray(s)?s:[s]:[];this._stack=[ye,{host:n,root:a},E(this._props),...i],D(this._stack,this.patch),this.patch(),i.forEach(l=>{if(typeof l=="object"&&l!==null){for(let p in l)if((typeof l[p]=="function"||l[p]instanceof Element)&&isNaN(p)&&!(p in this._host)){let h=typeof l[p]=="function"?l[p].bind(this):l[p];Object.defineProperty(this._host,p,{get(){return h}})}}})})()}setProp(t,n){switch(t){case"is":case"class":case"part":case"style":return;default:{let r=this._props[t];if(r!==n){if(t in this._refs){let a=this._refs[t][0];if(ue(n)&&n.record===a.record)return;H(this._props,t,this._refs[t][1]),H(a.record,a.key,this._refs[t][2]),delete this._refs[t]}if(H(r,this.patch),ue(n)){let a=s=>{n.record[n.key]=s},o=s=>{this._props[t]=s};this._refs[t]=[n,a,o],E(this._props,t,a),E(n.record,n.key,o),this._props[t]=n.record[n.key]}else this._props[t]=n;r===void 0&&E(this._props,t,this.patch),D(this._props,this.patch),this.patch()}}}}get component(){return this._component}get host(){return this._host}get root(){return this._tree.el}get props(){return this._props}get whenRunning(){return()=>this._running}patch(t){t&&(typeof t=="function"?(this._patcher=t,this._template=void 0):(this._patcher=void 0,this._template=typeof t=="string"?B(t):t)),this._requirePatch||(this._requirePatch=!0,setTimeout(()=>{if(this._requirePatch=!1,this._stack){let n=this._patcher?this._patcher(this._stack):this._template?c(this._template,this._stack,this._cache):this._tree&&this._component.template?c(this._component.template,this._stack,this._cache):void 0;n&&this._updater.patch(n)}}))}dispatch(t,n=null){this._host.dispatchEvent(new CustomEvent(t,{detail:n}))}toJSON(){return{component:this._component,props:this._props,tree:this._tree}}};function ct(e){return"tag"in e&&(e.tag==="style"||e.tag==="link")}function Ie(e){return e.tag==="link"&&e.props?.href!==""&&(e.props?.rel).toLocaleLowerCase()==="stylesheet"}var je=class{constructor(t){this.tree=t;this._waitUrls=new Set;this.loaded=t=>{this.removeWaitUrl(t.target.getAttribute("href"))}}patch(t){let n=ge(t,ct),r=t,a=this.header?.children?.filter(Ie)||[],o=n.children?.filter(Ie)||[],s=o.filter(l=>a.every(p=>p.props?.href!==l.props?.href)),i=a.filter(l=>o.every(p=>p.props?.href!==l.props?.href));o.forEach(l=>{((l.on??={}).load??=[]).includes(this.loaded)||l.on.load.push(this.loaded),(l.on.error??=[]).includes(this.loaded)||l.on.error.push(this.loaded)}),s.forEach(l=>{this.addWaitUrl(l.props?.href),l.new=!0}),i.forEach(l=>this.removeWaitUrl(l.props?.href)),i?I(this.tree,oe(this.header,n,this.body)):I(this.tree,oe(n,this.body)),s.forEach(l=>l.new=!1),this.header=n,this.update=()=>{I(this.tree,oe(this.header,r)),this.body=r}}set update(t){this._update=t,this._executeUpdate()}addWaitUrl(t){this._waitUrls.add(t)}removeWaitUrl(t){this._waitUrls.delete(t),this._executeUpdate()}_executeUpdate(){!this._waitUrls.size&&this._update&&(this._update(),this._update=void 0)}};var w="beako-element",b=class extends HTMLElement{constructor(){super()}setProp(t,n){this._entity?.setProp(t,n)}static getComponent(){}loadProps(){this.hasAttributes()&&this.getAttributeNames().forEach(t=>{this.setProp(t,this.getAttribute(t))})}whenRunning(){return this._entity?this._entity.whenRunning():new Promise(t=>{this._run=t})}_setEntity(t){this._entity=t,this._run&&this._entity.whenRunning().then(this._run)}get entity(){return this._entity}get attributes(){return ut(super.attributes,this.setProp)}setAttribute(t,n){this.setProp(t,n),super.setAttribute(t,n)}getAttributeNode(t){let n=super.getAttributeNode(t);return n&&$e(n,this.setProp)}removeAttribute(t){return this.setProp(t,void 0),super.removeAttribute(t)}removeAttributeNode(t){return this.setProp(t.name,void 0),super.removeAttributeNode(t)}toJSON(){return{entity:this._entity}}},Be=class extends b{constructor(){super()}setProp(t,n){if(t==="component")switch(typeof n){case"string":{let r=customElements.get(n);if(r&&b.isPrototypeOf(r)){let a=r.getComponent();if(a){let o=L(this.attachShadow(a.options));this._setEntity(new x(a,this,o))}}else throw Error(n+" is not a component.");break}case"object":if(k(n)){let r=L(this.attachShadow(n.options));this._setEntity(new x(n,this,r))}else if(n!==null)throw Error("The object is not a component.");break}super.setProp(t,n)}};customElements.get(w)||customElements.define(w,Be);function $e(e,t){return new Proxy(e,{set(n,r,a){if(t(r,a),r==="value")return n.value=a}})}function ut(e,t){return new Proxy(e,{get:function(n,r){return r==="length"?n[r]:$e(n[r],t)}})}async function mt(e,t){let n;if(typeof e=="string")n=document.createElement(e);else{n=document.createElement(w);let r=await Promise.resolve(e),a=ae(r)&&k(r.default)?r.default:r;n.setAttribute("component",a)}if(t)for(let r in t)n.setAttribute(r,t[r]);if(typeof e=="string"){let r=customElements.get(e);r!==void 0&&Object.prototype.isPrototypeOf.call(b,r)&&await n.whenRunning()}else await n.whenRunning();return n}var Ge={match(e,t,n){if(e.type==="custom"){if(e.tag===w)return!0;let r=e,a=y(t,r.tag)[0];if(typeof a=="object"&&a!==null&&(k(a)||ae(a)&&k(a.default)))return!0;{let o=customElements.get(r.tag);return o!==void 0&&Object.prototype.isPrototypeOf.call(b,o)}}return!1},exec(e,t,n){let r=e,a={tag:w},o;r.tag!==w&&(o=y(t,r.tag)[0],o?(a.props??={}).component=o:a.tag=r.tag);let s=[],i=[],l=(r.children||[])?.flatMap(p=>{if(typeof p!="string"){let h=p;if(h.props){if(h.props["@as"])return i.push([h.props["@as"],h]),[];if(h.props.slot)return[c(p,t,n)]}}return s.push(p),[]});return s.length&&i.push(["content",{type:"group",children:s}]),i.length&&(a.props||(a.props={}),i.forEach(([p,h])=>{a.props[p]={type:"evaluation",template:h,stack:t}})),l.length&&(a.children=l),S(r,t,n,a),r.tag===w&&(o=a.props?.component,(a.props??={}).component=o),typeof o=="object"&&o!==null&&"default"in o&&o[Symbol.toStringTag]==="Module"&&k(o.default)&&(o=o.default,(a.props??={}).component=o),r.cache!==o&&(a.new=!0),r.cache=o,a}},ze={match(e,t,n){if(e.type==="custom"&&$ in n&&!M(e.tag)){let r=y(t,e.tag)[0];return n[$].some(a=>a===r)}return!1},exec(e,t,n){let a={el:y(t,e.tag)[0]||ShadowRoot,override:!0,invalid:{props:!0,children:!0}};return S(e,t,n,a),a}};c.plugin(Ge);c.plugin(ze);function G(e,t=[]){let n={data:typeof t=="function"||Array.isArray(t)?t:[t],options:{mode:"open"}};return typeof e=="function"?n.patcher=e:n.template=typeof e=="string"?B(e):e,N(n)}function ft(e,t,n=[]){let r=k(t)?t:G(t,n);if(r.options.localeOnly)throw Error("This componet is local only.");customElements.define(e,class extends b{constructor(){super();let a=L(this.attachShadow(r.options));this._setEntity(new x(r,this,a)),this.innerHTML?(this.entity.setProp("content",this.innerHTML),this.hasAttributes()&&this.getAttributeNames().forEach(o=>{this.entity.setProp(o,this.getAttribute(o))})):this.loadProps()}static getComponent(){return r}})}function dt(e,t,n=[]){let r=typeof e=="string"?document.querySelector(e):e,a=k(t)?t:G(t,n);if(a.options.localeOnly)throw Error("This componet is local only.");let o=L(r.attachShadow(a.options)),s=new x(a,r,o);r.innerHTML&&s.setProp("content",r.innerHTML),r.hasAttributes()&&r.getAttributeNames().forEach(i=>{s.setProp(i,r.getAttribute(i))})}function ht(e,t={}){return e.options=Object.freeze({mode:"closed",...t}),Object.freeze(e)}export{b as ComponentElement,x as Entity,X as Loop,ye as builtin,Je as change,G as compact,ft as define,P as destroy,mt as elementize,c as evaluate,A as eventTypes,d as expression,L as load,N as lock,dt as mount,B as parse,I as patch,y as pickup,D as reach,Ue as receive,ht as seal,We as unlock,ie as unreach,H as unwatch,E as watch};
