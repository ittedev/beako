const c=Symbol("Beako");function z(e,t){const n=e.value;n!==t&&e.arms.forEach(s=>{switch(s[0]){case"bio":s[1]();break;case"bom":e.arms.delete(s);case"spy":s[1](t,n);break}}),e.value=t}function l(e,t,n){c in e||(e[c]={}),t!==void 0&&(t in e[c]||(e[c][t]={value:e[t],arms:new Set},Object.defineProperty(e,t,{get(){return this[c][t].value},set(s){z(this[c][t],s)}})),n&&e[c][t].arms.add(n))}function A(e,t,n){if(typeof e=="object"&&e!==null){const s=e;if(l(s),n===void 0){const r=t?typeof t=="function"?["bio",t]:t:void 0;for(const i in s)l(s,i,r);if(Array.isArray(s))return s;for(const i in s){const a=[...s[c][i].arms].filter(o=>o[0]==="bio");a.length?a.forEach(o=>A(s[i],o)):A(s[i])}}else{const r=typeof n=="function"?["spy",n]:n;Array.isArray(t)?t.forEach(i=>l(s,i,r)):l(s,t,r)}}return e}export{A as watch};async function B(e,t){const n=Array.isArray(t)?t:[t],s=await Promise.all(n.map(r=>e[r]===void 0?new Promise(i=>{l(e,r,["bom",i])}):e[r]));return n.reduce((r,i,a)=>(r[i]=s[a],r),{})}export{B as receive};function b(e,t,n){if(t!==void 0)c in e&&t in e[c]&&(n?e[c][t].arms.forEach(s=>{s[1]===n&&e[c][t].arms.delete(s)}):e[c][t].arms.clear(),e[c][t].arms.size||(Object.defineProperty(e,t,{enumerable:!0,configurable:!0,writable:!0,value:e[c][t].value}),delete e[c][t]));else{for(const s in e[c])b(e,s);delete e[c]}}function x(e,t,n){if(typeof e=="object"&&e!==null){const s=e;if(n===void 0)if(t){const r=t;for(const i in s)b(s,i,r),x(s[i],r)}else{for(const r in s)x(s[r]);b(s)}else Array.isArray(t)?t.forEach(r=>b(s,r,n)):b(s,t,n)}return e}export{x as unwatch};function w(e,t){const n=typeof t=="function"?["bio",t]:t;if(typeof e=="object"&&e!==null){const s=e;if(c in s)for(const r in s[c])l(s,r,n);for(const r in s)w(s[r],n)}return e}export{w as reach};function T(e){const t={node:e};return C(t),t}function D(e){const t={tag:e.tagName.toLowerCase(),node:e};return J(t),C(t),t}function J(e){if(e.node.hasAttributes()){const t={};e.node.getAttributeNames().forEach(n=>{if(n.startsWith("on"))return;const s=e.node.getAttribute(n);switch(n){case"class":case"part":return e[n]=s.split(/\s+/);case"style":return e.style=s;default:return t[n]=s}}),Object.keys(t).length&&(e.attr=t)}}function C(e){if(e.node.hasChildNodes()){const t=e.node.childNodes;e.children=[];for(let n=0;n<t.length;n++)switch(t[n].nodeType){case 3:e.children.push(t[n].data);break;case 1:e.children.push(D(t[n]));break}}}export{T as load};function k(e,t){return $(e,t),e}function y(e,t){return e.tag!==t.tag?y({tag:t.tag,node:document.createElement(t.tag)},t):(O(e,t),H(e,t),U(e,t),Z(e,t),q(e,t),$(e,t),"key"in t?e.key=t.key:delete e.key,e)}function O(e,t){const n=e.class||[],s=t.class||[],r=s.filter(a=>!n.includes(a));r.length&&e.node.classList.add(...r);const i=n.filter(a=>!s.includes(a));i.length&&e.node.classList.remove(...i),s.length?e.class=s.slice():delete e.class}function H(e,t){const n=e.part||[],s=t.part||[],r=s.filter(a=>!n.includes(a));r.length&&e.node.part.add(...r);const i=n.filter(a=>!s.includes(a));i.length&&e.node.part.remove(...i),s.length?e.part=s.slice():delete e.part}function U(e,t){if(e.node instanceof HTMLElement){const n=e.style||"",s=t.style||"";n!=s&&(e.node.style.cssText=s,s!=""?e.style=s:delete e.style)}}function Z(e,t){const n=e.attr||{},s=t.attr||{},r=Object.keys(n),i=Object.keys(s),a=i.filter(h=>!r.includes(h)||n[h]!==s[h]);for(const h of a)e.node.setAttribute(h,s[h]);const o=r.filter(h=>!i.includes(h));for(const h of o)e.node.removeAttribute(h);i.length?e.attr={...s}:delete e.attr}function q(e,t){}class I{index=0;node;parent;children;stock;constructor(t){this.stock=new Map,this.parent=t,this.node=t.node.firstChild,this.children=t.children||[]}get isEnd(){return this.index>=this.children.length}get ve(){return this.children[this.index]}next(){typeof this.children[this.index]=="number"?this.index++:this.node&&(this.index++,this.node=this.node.nextSibling)}prev(){typeof this.children[this.index]=="number"?this.index--:this.node?(this.index--,this.node=this.node.previousSibling):(this.node=this.parent.node.lastChild,this.node&&this.index--)}add(t){const n=typeof t=="string"?document.createTextNode(t):t.node;return this.node=this.parent.node.insertBefore(n,this.node||null),this.next(),t}replace(t){if(typeof t=="string"&&this.node?.nodeType===3)this.node.data!==t&&(this.node.data=t);else{const n=typeof t=="string"?document.createTextNode(t):t.node;this.node!==n&&(typeof this.ve=="object"&&"key"in this.ve&&this.stock.set(this.ve.key,this.ve),this.parent.node.replaceChild(n,this.node))}return this.next(),t}remove(){typeof this.ve=="object"&&"key"in this.ve&&this.stock.set(this.ve.key,this.ve);const t=this.node;this.node=t?.nextSibling||null,this.parent.node.removeChild(t)}removeAll(){if(this.node)for(let t=this.node;t!==null;t=t.nextSibling)this.parent.node.removeChild(t)}has(t){return this.stock.has(t)}addFromKey(t,n){const s=this.stock.get(t);return this.stock.delete(t),this.add(y(s,n))}clear(){this.stock.clear()}search(t){if(this.isEnd)return!1;const n=t();if(console.log("result:",n),typeof n=="boolean")return n;{this.next();const s=this.search(t);return this.prev(),s&&(this.remove(),this.index++),s}}}function $(e,t){const n=t.children||[],s=new I(e),r=n.filter(o=>typeof o=="number").reverse();let i=r.pop();const a=n.map(o=>{switch(typeof o){case"string":return!s.isEnd&&typeof s.ve=="string"?s.replace(o):s.add(o);case"object":{if("key"in o){if(s.has(o.key))return s.addFromKey(o.key,o);if(typeof s.ve=="object"&&s.search(()=>{if(typeof s.ve=="object"&&o.key===s.ve.key)return!0;if(typeof s.ve=="number"&&i!=null&&s.ve===i)return!1}))return s.replace(y(s.ve,o))}if(typeof s.ve=="object"){const h="key"in s.ve?{tag:o.tag,node:document.createElement(o.tag)}:s.ve;return s.replace(y(h,o))}else return s.add(y({tag:o.tag,node:document.createElement(o.tag)},o))}case"number":{const h=s.search(()=>{if(typeof s.ve=="number"&&o===s.ve)return!0});return i=r.pop(),h&&s.next(),s.clear(),o}}});s.removeAll(),a.length?e.children=a:delete e.children}export{k as patch};export{y as patchElement};function L(e,t){switch(e){case"script":switch(t){case"+":case"-":return"multi";case"void":case"typeof":case"~":case"!":return"unary";case"/":case"*":case"%":case"**":case"in":case"instanceof":case"<":case">":case"<=":case">=":case"==":case"!=":case"===":case"!==":case"<<":case">>":case">>>":case"&":case"|":case"^":case"&&":case"||":case"??":return"binary";case"=":case"*=":case"**=":case"/=":case"%=":case"+=":case"-=":case"<<=":case">>=":case">>>=":case"&=":case"^=":case"|=":case"&&=":case"||=":case"??=":return"assign";case"++":case"--":return"crement";case"false":case"true":return"boolean";case"null":case"undefined":case".":case"?.":case"[":case"]":case"{":case"}":case"(":case")":case"...":case"?":case":":case",":case"'":case'"':case"`":return t}switch(!0){case/^\/\/.*$/.test(t):return"lineComment";case/^[_\$a-zA-Z][_\$a-zA-Z0-9]*$/.test(t):return"word";case/^\d+\.?\d*$|^\.?\d+$/.test(t):return"number"}break;case"template":switch(t){case"$":return"partial";case"${":return t;case"}":return t;case"`":return"`";case"\r":case`
`:case`\r
`:return"other"}case"singleString":case"doubleString":switch(t){case"\\":return"partial";case"\r":case`
`:case`\r
`:return"return";case`\\\r
`:return"escape";case"'":if(e==="singleString")return t;break;case'"':if(e==="doubleString")return t;break}switch(!0){case/^\\(x|u)$/.test(t):return"partial";case/^\\.$/.test(t):return"escape"}break;case"innerText":switch(t){case"{":case"}":return"partial";case"{{":case"}}":return t}break}return"other"}class p{text;field;index;token;constructor(t,n,s=0,r=null){this.text=t,this.field=n,this.index=s,this.token=r}_next(t){const n=["",""];for(this.index=t;this.index<this.text.length;this.index++){const s=L(this.field,n[1]+this.text[this.index]);if(s==="other")return n;n[0]=s,n[1]=n[1]+this.text[this.index]}return n}skip(){let t="";if(!this.token)for(let n=this.index;n<this.text.length;n++)if(L(this.field,this.text[n])==="other")t+=this.text[n];else if(this.token=this._next(n),this.token&&this.token[0]==="partial")t+=this.token[1],this.token=null;else return t;return t}nextType(){return this.skip(),this.token?this.token[0]:""}pop(){this.skip();const t=this.token;return this.token=null,t||null}expand(t,n){const s=this.field;this.field=t,n(),this.token&&(this.index-=this.token[1].length,this.token=null),this.field=s}}export{p as Lexer};function d(e,t,n=""){if(!e||e[0]!==t)throw Error(n)}function P(e){const t=[];for(t.push(e.skip());e.nextType();)console.log("lexer.nextType():",e.nextType()),e.nextType()==="{{"?(e.pop(),e.expand("script",()=>{t.push(f(e))}),d(e.pop(),"}}"),t.push(e.skip())):e.pop();const n=t.filter(s=>s!=="");return n.length===1&&typeof n[0]=="string"?n[0]:{type:"join",values:n,separator:""}}function f(e){return V(e)}function V(e){let t=M(e);for(;e.nextType()==="?";){e.pop();const n=f(e);d(e.pop(),":");const s=M(e);t={type:"if",condition:t,truthy:n,falsy:s}}return t}function M(e){const t=new Array;for(t.push(v(e));e.nextType()==="multi"||e.nextType()==="binary";)t.push(e.pop()[1]),t.push(v(e));for(;t.length>1;)for(let n=0;n+1<t.length;n+=2)if(n+3>=t.length||R(t[n+1])>R(t[n+3])){const s={type:"binary",operator:t[n+1],left:t[n],right:t[n+2]};t.splice(n,3,s)}return typeof t[0]=="string"?{type:"variable",name:t[0]}:t[0]}function R(e){switch(e){default:return 0;case"||":case"??":return 4;case"&&":return 5;case"|":return 6;case"^":return 7;case"&":return 8;case"==":case"!=":case"===":case"!==":return 9;case"in":case"instanceof":case"<":case">":case"<=":case">=":return 10;case"<<":case">>":case">>>":return 11;case"+":case"-":return 12;case"*":case"/":case"%":return 13;case"**":return 14}}function v(e){switch(e.nextType()){case"multi":case"!":return{type:"unary",operator:e.pop()[1],operand:v(e)};default:return W(e)}}function W(e){let t=G(e);for(;;){switch(e.nextType()){case"(":{e.pop();const n=[];for(;e.nextType()!==")"&&(n.push(f(e)),e.nextType()===",");)e.pop();d(e.pop(),")"),t={type:"function",name:t,params:n};continue}case".":{e.pop();const n=e.pop();d(n,"word"),t={type:"hash",object:t,key:{type:"literal",value:n[1]}};continue}case"[":{e.pop();const n=f(e);d(e.pop(),"]"),t={type:"hash",object:t,key:n};continue}}break}return t}function G(e){const t=e.pop();switch(t[0]){case"word":return{type:"variable",name:t[1]};case"number":return{type:"literal",value:Number(t[1])};case"boolean":return{type:"literal",value:t[1]==="true"};case"undefined":return{type:"literal",value:void 0};case"null":return{type:"literal",value:null};case'"':return N(e,"doubleString",t[0]);case"'":return N(e,"singleString",t[0]);case"`":return N(e,"template",t[0]);case"(":{const n=f(e);return d(e.pop(),")"),n}default:throw new Error(JSON.stringify(t))}}function N(e,t,n){const s=[""];let r=0;return e.expand(t,()=>{t:for(;;){s[r]+=e.skip();const i=e.pop();switch(i[0]){case n:break t;case"return":throw Error();case"escape":s[r]+=i[1];continue;case"${":e.expand("script",()=>{s.push(f(e))}),d(e.pop(),"}"),s.push(e.skip()),r+=2}}}),r===0?{type:"literal",value:s[0]}:{type:"join",values:s.filter(i=>i!==""),separator:""}}export{P as innerText};export{f as expression};const Q=new DOMParser;function S(e){if(typeof e=="string"){const t=Q.parseFromString(e,"text/html");return{type:"tree",children:m(t.head).concat(m(t.body))}}else{const t=e.content;return{type:"tree",children:m(t)}}}class X{node;constructor(t){this.node=t}hasAttribute(t){return!!(this.node&&this.node.nodeType===1&&this.node.hasAttribute(t))}pop(){const t=this.node;return this.node=this.node?this.node.nextSibling:null,t}}function m(e){const t=new X(e.firstChild),n=[];for(;t.node;)n.push(Y(t));return n}function Y(e){switch(e.node.nodeType){case 3:return tt(e.pop());case 1:return j(e);default:return""}}function tt(e){return P(new p(e.data,"innerText"))}function et(e){return j(e)}function j(e){const t=e.node;if(t.hasAttribute("@for")){const n=t.getAttribute("@each"),s=f(new p(t.getAttribute("@for"),"script"));return{type:"each",each:n,array:s,value:F(e)}}else return F(e)}function F(e){const t=e.node;if(t.hasAttribute("@if")){const n=f(new p(t.getAttribute("@if"),"script")),s=_(t);e.pop();const r=e.hasAttribute("@else")?et(e):void 0;return{type:"if",condition:n,truthy:s,falsy:r}}else return _(e.pop())}function _(e){return nt(e)}function nt(e){const t={type:"element",tag:e.tagName.toLowerCase()};if(e.hasAttributes()){const n=[];e.getAttributeNames().forEach(s=>{const r=e.getAttribute(s);switch(s){case"class":case"part":return s in t||(t[s]=[]),t[s].push(r.split(/\s+/));case"style":return n.push(r)}{const i=s.match(/^(?<name>.+)(\+.*)$/);if(i?.groups)switch(i.groups.name){case"class":case"part":return i.groups.name in t||(t[i.groups.name]=[]),t[i.groups.name].push({type:"flags",value:f(new p(r,"script"))});case"style":return n.push(f(new p(r,"script")))}}{const i=s.match(/^(?<name>.+):$/);if(i?.groups)return"attr"in t||(t.attr={}),t.attr[i.groups.name]=f(new p(r,"script"))}if(s.match(/^(?<name>.+)\*$/)?.groups,!s.match(/^@.+$/)&&("attr"in t||(t.attr={}),!(s in t.attr)))return t.attr[s]=r}),n.length&&(n.length===1&&typeof n[0]=="string"?t.style=n[0]:t.style={type:"join",values:n.filter(s=>s!==""),separator:";"})}return e.hasChildNodes()&&(t.children=m(e)),t}export{S as parse};function st(e){return typeof e=="object"&&"type"in e}function rt(e,t){switch(e){case"void":return;case"typeof":return typeof t;case"+":return+t;case"-":return-t;case"~":return~t;case"!":return!t;default:throw Error(e+" does not exist")}}function it(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"/":return t/n;case"*":return t*n;case"%":return t%n;case"**":return t**n;case"in":return t in n;case"instanceof":return t instanceof n;case"<":return t<n;case">":return t>n;case"<=":return t<=n;case">=":return t>=n;case"==":return t==n;case"!=":return t!=n;case"===":return t===n;case"!==":return t!==n;case"<<":return t<<n;case">>":return t>>n;case">>>":return t>>>n;case"&":return t&n;case"|":return t|n;case"^":return t^n;case"&&":return t&&n;case"||":return t||n;case"??":return t??n;default:throw Error(e+" does not exist")}}function u(e,t=[]){return E[e.type](e,t)}function ot(e){if(typeof e=="string")return e.split(/\s+/);if(typeof e=="object"){if(Array.isArray(e))return e;if(e)return Object.keys(e).filter(t=>e[t])}return[]}const E={literal:(e,t)=>e.value,variable:(e,t)=>{for(let n=t.length-1;n>=0;n--)if(e.name in t[n])return t[n][e.name];throw Error(e.name+" is not defined")},unary:(e,t)=>rt(e.operator,u(e.operand,t)),binary:(e,t)=>it(e.operator,u(e.left,t),u(e.right,t)),function:(e,t)=>{const n=u(e.name,t);if(typeof n=="function")return n(...e.params.map(s=>u(s,t)));throw Error(e.name.toString()+" is not a function")},hash:(e,t)=>u(e.object,t)[u(e.key,t)],join:(e,t)=>e.values.reduce((n,s,r)=>{if(st(s)){const i=u(s,t);return n+(r?e.separator:"")+(typeof i=="object"?JSON.stringify(i):i)}else return n+(r?e.separator:"")+s},""),flags:(e,t)=>ot(u(e.value,t)),if:(e,t)=>u(e.condition,t)?u(e.truthy,t):e.falsy?u(e.falsy,t):null,each:(e,t)=>(u(e.array,t),""),element:(e,t)=>{const n=E.tree(e,t);if(n.tag=e.tag,e.style&&(n.style=typeof e.style=="string"?e.style:u(e.style,t)),e.attr){n.attr={};for(const s in e.attr){const r=e.attr[s];n.attr[s]=typeof r=="string"?r:u(r,t)}}return n},tree:(e,t)=>{let n=[];return e.children?.forEach(s=>{if(typeof s=="string")n.push(s);else{const r=u(s,t);Array.isArray(r)?n=n.concat(r):n.push(r)}}),n.length?{children:n}:{}}};export{u as evaluate};export{E as evaluator};const g={console,Object,Number,Math,Date,Array,JSON,String,isNaN,isFinite,location};function K(e,t){return new Proxy(e,{set(n,s,r){if(t(s,r),s==="value")return n.value=r}})}function ct(e,t){return new Proxy(e,{get:function(n,s){return s==="length"?n[s]:K(n[s],t)}})}class at extends HTMLElement{template=null;tree=null;stack=null;attr={};construct=null;constructor(){super()}patch(){this.stack&&this.tree&&this.template&&k(this.tree,u(this.template,this.stack))}static get observedAttributes(){return["class","part","style"]}setRawAttribute(t,n){switch(console.log("setRawAttribute()",t,n),t){case"class":case"part":case"style":return;default:this.attr[t]=n}this.patch()}get attributes(){return ct(super.attributes,this.setRawAttribute)}setAttribute(t,n){this.setRawAttribute(t,n),super.setAttribute(t,n)}attributeChangedCallback(t,n,s){console.log("attributeChangedCallback()",t,n,s)}getAttributeNode(t){const n=super.getAttributeNode(t);return n&&K(n,this.setRawAttribute)}removeAttribute(t){return this.setRawAttribute(t,void 0),super.removeAttribute(t)}removeAttributeNode(t){return this.setRawAttribute(t.name,void 0),super.removeAttributeNode(t)}}function ut(e,t=[],n={mode:"open"}){const s=typeof e=="string"?S(e):e;return class extends at{constructor(){super();console.log("constructor()"),this.template=s,this.tree=T(this.attachShadow(n)),console.log("stack:",t),typeof t=="function"?(this.construct=t,(async()=>{if(this.construct){const r=await this.construct(this.attr);console.log("stack2:",r),this.stack=r?Array.isArray(r)?[g,...r]:[g,r]:[g],this.construct=null}this.patch(),w(t,this.patch)})().then()):(this.stack=Array.isArray(t)?[g,...t]:[g,t],this.patch(),w(t,this.patch)),this.hasAttributes()&&this.getAttributeNames().forEach(r=>{this.setRawAttribute(r,this.getAttribute(r))})}}}export{g as builtin};export{ut as compact};function ht(e,t,n){const s=typeof e=="string"?document.querySelector(e):e.nodeType===9?e.body:e,r=typeof t=="string"?S(t):t,i=s.attachShadow({mode:"open"}),a=T(i),o=()=>k(a,u(r,n));w(n,o),o()}export{ht as hack};
