const u=Symbol("Beako"),l=Symbol("Reactive"),m=Symbol("Array"),g=Symbol("Beako-lock");function E(t,e,s){if(typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Array.isArray(t))){const n=t;if(!n[g])if(_(n),s===void 0){const r=n[u][l][1];typeof e=="function"&&r.add(e);for(const i in n){_(n,i,n[u][l][0]);const o=n[i];typeof o=="object"&&o!==null&&(r.size?r.forEach(c=>{(!(u in o)||!o[u][l][1].has(c))&&E(o,c)}):u in o||E(o))}if(Array.isArray(n)){const i=n[u][m].length;if(n.length<i)for(let o=n.length;o<i;o++)_(n,o);n.length=i}}else{const r=typeof s=="function"?["spy",s]:s;Array.isArray(e)?e.forEach(i=>_(n,i,r)):_(n,e,r)}}return t}function _(t,e,s){if(!t[g]){if(!(u in t)){const n=()=>{t[u][l][1].forEach(r=>r())};if(t[u]={[l]:[["bio",n],new Set]},Array.isArray(t)){const r=t[u][m]=t.slice(),i=c=>(n(),c),o=c=>(E(t),n(),c);Object.defineProperties(t,{unshift:{get(){return(...c)=>o(Array.prototype.unshift.call(r,...c))}},push:{get(){return(...c)=>o(Array.prototype.push.call(r,...c))}},splice:{get(){return(c,p,...f)=>o(p===void 0?Array.prototype.splice.call(r,c,r.length-c):Array.prototype.splice.apply(r,[c,p,...f]))}},pop:{get(){return()=>o(Array.prototype.pop.call(r))}},shift:{get(){return()=>o(Array.prototype.shift.call(r))}},sort:{get(){return c=>i(c===void 0?Array.prototype.sort.call(r):Array.prototype.sort.call(r,c))}},reverse:{get(){return()=>i(Array.prototype.reverse.call(r))}},copyWithin:{get(){return(c,p,f)=>i(Array.prototype.copyWithin.call(r,c,p!==void 0?p:0,f!==void 0?f:r.length))}}})}}if(e!==void 0)if(typeof e!="number"&&isNaN(e)){if(e in t[u]||(t[u][e]=[t[e],new Set],Object.defineProperty(t,e,{get(){return this[u][e][0]},set(n){t[u][l][1].forEach(r=>E(n,r)),ae(this[u][e],n)}})),s){for(const n of t[u][e][1])if(n[1]===s[1])return;t[u][e][1].add(s)}}else{const n=Object.getOwnPropertyDescriptor(t,e);(!n||"value"in n)&&e in t[u][m]&&Object.defineProperty(t,e,{get(){return this[u][m][e]},set(r){t[u][l][1].forEach(o=>E(r,o));const i=this[u][m][e];this[u][m][e]=r,i!==r&&t[u][l][0][1]()},configurable:!0,enumerable:!0})}}}function ae(t,e){const s=t[0];t[0]=e,s!==e&&t[1].forEach(n=>{switch(n[0]){case"bio":n[1]();break;case"bom":t[1].delete(n);case"spy":n[1](e,s);break}})}async function ue(t,e){if(!t[g]){const s=Array.isArray(e)?e:[e],n=await Promise.all(s.map(r=>t[r]===void 0?new Promise(i=>{_(t,r,["bom",i])}):t[r]));return s.reduce((r,i,o)=>(r[i]=n[o],r),{})}return{}}function O(t,e,s){if(e!==void 0)u in t&&e in t[u]&&(s?t[u][e][1].forEach(n=>{n[1]===s&&t[u][e][1].delete(n)}):t[u][e][1].clear());else{for(const n in t[u])Object.defineProperty(t,n,{enumerable:!0,configurable:!0,writable:!0,value:t[u][n][0]}),delete t[u][n];Array.isArray(t)&&(delete t.push,delete t.sort,delete t.splice),delete t[u]}}function w(t,e,s){if(typeof t=="object"&&t!==null){const n=t;if(!n[g])if(s===void 0)if(e){const r=e;n[u]&&n[u][l][1].delete(r);for(const i in n)w(n[i],r)}else{for(const r in n)w(n[r]);O(n)}else Array.isArray(e)?e.forEach(r=>O(n,r,s)):O(n,e,s)}return t}function x(t,e){if(typeof t=="object"&&t!==null){const s=t;if(!s[g]){u in s&&s[u][l][1].add(e);for(const n in s)x(s[n],e)}}return t}function L(t){return t[g]=!0,t}function pe(t){return delete t[g],t}export{E as watch};export{ue as receive};export{w as unwatch};export{x as reach};export{L as lock};export{pe as unlock};function $(t){const e={node:t};return H(e),e}function fe(t){const e={tag:t.tagName.toLowerCase(),node:t};return he(e),H(e),e}function he(t){if(t.node.hasAttributes()){const e={};t.node.getAttributeNames().forEach(s=>{if(s.startsWith("on"))return;const n=t.node.getAttribute(s);switch(s){case"class":case"part":return t[s]=n.split(/\s+/);case"style":case"is":return t[s]=n;default:return e[s]=n}}),Object.keys(e).length&&(t.props=e)}}function H(t){if(t.node.hasChildNodes()){const e=t.node.childNodes;t.children=[];for(let s=0;s<e.length;s++)switch(e[s].nodeType){case 1:if(e[s].tagName==="SCRIPT")break;t.children.push(fe(e[s]));break;case 3:t.children.push(e[s].data);break}}}function z(t,e){return B(t,e),t}function k(t,e){return t.tag!==e.tag||t.is!==e.is?k(e.is?{tag:e.tag,is:e.is,node:document.createElement(e.tag,{is:e.is})}:{tag:e.tag,node:document.createElement(e.tag)},e):(de(t,e),le(t,e),ye(t,e),ge(t,e),be(t,e),B(t,e),me(t,e),"key"in e?t.key=e.key:delete t.key,t)}function de(t,e){const s=(t.class||[]).join(" "),n=(e.class||[]).join(" ");s!==n&&(t.node.className=n),n.length?t.class=(e.class||[]).slice():delete t.class}function le(t,e){const s=t.part||[],n=e.part||[],r=n.filter(o=>!s.includes(o));r.length&&t.node.part.add(...r);const i=s.filter(o=>!n.includes(o));i.length&&t.node.part.remove(...i),n.length?t.part=n.slice():delete t.part}function ye(t,e){if(t.node instanceof HTMLElement){const s=t.style||"",n=e.style||"";s!=n&&(t.node.style.cssText=n,n!=""?t.style=n:delete t.style)}}function ge(t,e){const s=t.props||{},n=e.props||{},r=Object.keys(s),i=Object.keys(n);i.filter(o=>!r.includes(o)||s[o]!==n[o]).forEach(o=>t.node.setAttribute(o,n[o])),r.filter(o=>!i.includes(o)).forEach(o=>t.node.removeAttribute(o)),i.length?t.props={...n}:delete t.props}function be(t,e){const s=t.on||{},n=e.on||{},r=Object.keys(s),i=Object.keys(n);i.filter(o=>!r.includes(o)).forEach(o=>{n[o].forEach(c=>{t.node.addEventListener(o,c)})}),r.filter(o=>!i.includes(o)).forEach(o=>{s[o].forEach(c=>{t.node.removeEventListener(o,c)})}),i.filter(o=>r.includes(o)).forEach(o=>{const c=n[o],p=s[o];c.filter(f=>!p.includes(f)).forEach(f=>t.node.addEventListener(o,f)),p.filter(f=>!c.includes(f)).forEach(f=>t.node.removeEventListener(o,f))}),i.length?t.on=i.reduce((o,c)=>(o[c]=[...n[c]],o),{}):delete t.on}function me(t,e){if(Object.prototype.isPrototypeOf.call(HTMLInputElement.prototype,t.node)){const s=t.node;s.value!==e.props?.value&&(e.props&&"value"in e.props?s.value!==e.props?.value.toString()&&(s.value=e.props.value):t.node.value!==""&&(t.node.value="")),!s.checked&&e.props&&"checked"in e.props?s.checked=!0:s.checked&&!(e.props&&"checked"in e.props)&&(s.checked=!1)}if(Object.prototype.isPrototypeOf.call(HTMLOptionElement.prototype,t.node)){const s=t.node;!s.selected&&e.props&&"selected"in e.props?s.selected=!0:s.selected&&!(e.props&&"selected"in e.props)&&(s.selected=!1)}}class Ee{index=0;node;parent;children;stock;constructor(e){this.stock=new Map,this.parent=e,this.node=e.node.firstChild,this.children=e.children||[]}get isEnd(){return this.index>=this.children.length}get ve(){return this.children[this.index]}next(e=1){typeof this.children[this.index]=="number"?this.index+=e:this.node&&(this.index+=e,this.node=this.node.nextSibling)}prev(){typeof this.children[this.index]=="number"?this.index--:this.node?(this.index--,this.node=this.node.previousSibling):(this.node=this.parent.node.lastChild,this.node&&this.index--)}add(e){const s=typeof e=="string"?document.createTextNode(e):e.node,n=this.node;return this.node=this.parent.node.insertBefore(s,this.node||null),this.next(n?0:1),e}replace(e){if(typeof e=="string"&&this.node?.nodeType===3)this.node.data!==e&&(this.node.data=e);else{const s=typeof e=="string"?document.createTextNode(e):e.node;this.node!==s&&(typeof this.ve=="object"&&"key"in this.ve&&this.stock.set(this.ve.key,this.ve),this.parent.node.replaceChild(s,this.node),this.node=s)}return this.next(),e}remove(){typeof this.ve=="object"&&"key"in this.ve&&this.stock.set(this.ve.key,this.ve);const e=this.node;this.node=e?.nextSibling||null,this.parent.node.removeChild(e)}removeAll(){if(this.node)for(let e=this.node;e!==null;e=e.nextSibling)this.parent.node.removeChild(e)}has(e){return this.stock.has(e)}addFromKey(e,s){const n=this.stock.get(e);return this.stock.delete(e),this.add(k(n,s))}clear(){this.stock.clear()}search(e){if(this.isEnd)return!1;const s=e();if(typeof s=="boolean")return s;{this.next();const n=this.search(e);return this.prev(),n&&(this.remove(),this.index++),n}}}function B(t,e){const s=e.children||[],n=new Ee(t),r=s.filter(c=>typeof c=="number").reverse();let i=r.pop();const o=s.map(c=>{switch(typeof c){case"string":return!n.isEnd&&typeof n.ve=="string"?n.replace(c):n.add(c);case"object":{if("key"in c){if(n.has(c.key))return n.addFromKey(c.key,c);if(typeof n.ve=="object"&&n.search(()=>{if(typeof n.ve=="object"&&c.key===n.ve.key)return!0;if(typeof n.ve=="number"&&i!=null&&n.ve===i)return!1}))return n.replace(k(n.ve,c))}if(typeof n.ve=="object"){const p="key"in n.ve?{tag:c.tag,node:document.createElement(c.tag)}:n.ve;return n.replace(k(p,c))}else return n.add(k({tag:c.tag,node:document.createElement(c.tag)},c))}case"number":{const p=n.search(()=>{if(typeof n.ve=="number"&&c===n.ve)return!0});return i=r.pop(),p&&n.next(),n.clear(),c}}});n.removeAll(),o.length?t.children=o:delete t.children}function D(t,e){t.children?.forEach(s=>{typeof s=="object"&&(e(s),D(s,e))})}function R(t,e){for(const s of t.children||[])if(typeof s=="object"){if(e(s))return s;R(s,e)}return null}export{$ as load};export{z as patch};export{D as trace};export{R as find};class M{text;field;index;token;constructor(e,s,n=0,r=null){this.text=e,this.field=s,this.index=n,this.token=r}_next(e){const s=["",""];for(this.index=e;this.index<this.text.length;this.index++){const n=W(this.field,s[1]+this.text[this.index]);if(n==="other")return s;s[0]=n,s[1]=s[1]+this.text[this.index]}return s}skip(){let e="";if(!this.token)for(let s=this.index;s<this.text.length;s++)if(W(this.field,this.text[s])==="other")e+=this.text[s];else if(this.token=this._next(s),this.token&&this.token[0]==="partial")e+=this.token[1],this.token=null;else return e;return e}nextType(){return this.skip(),this.token?this.token[0]:""}pop(){this.skip();const e=this.token;return this.token=null,e||null}expand(e,s){const n=this.field;this.field=e,s(),this.token&&(this.index-=this.token[1].length,this.token=null),this.field=n}}function W(t,e){switch(t){case"script":switch(e){case"+":case"-":return"multi";case"void":case"typeof":case"~":case"!":return"unary";case"/":case"*":case"%":case"**":case"in":case"instanceof":case"<":case">":case"<=":case">=":case"==":case"!=":case"===":case"!==":case"<<":case">>":case">>>":case"&":case"|":case"^":case"&&":case"||":case"??":return"binary";case"=":case"*=":case"**=":case"/=":case"%=":case"+=":case"-=":case"<<=":case">>=":case">>>=":case"&=":case"^=":case"|=":case"&&=":case"||=":case"??=":return"assign";case"++":case"--":return"crement";case"false":case"true":return"boolean";case"null":case"undefined":case".":case"?.":case"[":case"]":case"{":case"}":case"(":case")":case"...":case"?":case":":case",":case"'":case'"':case"`":return e}switch(!0){case/^\/\/.*$/.test(e):return"lineComment";case/^[_\$a-zA-Z][_\$a-zA-Z0-9]*$/.test(e):return"word";case/^\d+\.?\d*$|^\.?\d+$/.test(e):return"number"}break;case"template":switch(e){case"$":return"partial";case"${":return e;case"}":return e;case"`":return"`";case"\r":case`
`:case`\r
`:return"other"}case"singleString":case"doubleString":switch(e){case"\\":return"partial";case"\r":case`
`:case`\r
`:return"return";case`\\\r
`:return"escape";case"'":if(t==="singleString")return e;break;case'"':if(t==="doubleString")return e;break}switch(!0){case/^\\(x|u)$/.test(e):return"partial";case/^\\.$/.test(e):return"escape"}break;case"text":switch(e){case"{":case"}":return"partial";case"{{":case"}}":return e}break}return"other"}function J(t){const e=[];for(e.push(t.skip());t.nextType();)t.nextType()==="{{"?(t.pop(),t.expand("script",()=>{e.push(d(t))}),y(t.pop(),"}}"),e.push(t.skip())):t.pop();const s=e.filter(n=>n!=="");return s.length===1&&typeof s[0]=="string"?s[0]:{type:"join",values:s,separator:""}}function d(t){return _e(t)}function _e(t){const e=Ae(t);if(t.nextType()==="assign"){if(e.type!=="get")throw Error("The left operand is not variable");const s=t.pop()[1],n=d(t);return{type:"assign",operator:s,left:e.value,right:n}}else return e}function Ae(t){let e=Z(t);for(;t.nextType()==="?";){t.pop();const s=d(t);y(t.pop(),":");const n=Z(t);e={type:"if",condition:e,truthy:s,falsy:n}}return e}function Z(t){const e=new Array;for(e.push(j(t));t.nextType()==="multi"||t.nextType()==="binary";)e.push(t.pop()[1]),e.push(j(t));for(;e.length>1;)for(let s=0;s+1<e.length;s+=2)if(s+3>=e.length||G(e[s+1])>G(e[s+3])){const n={type:"binary",operator:e[s+1],left:e[s],right:e[s+2]};e.splice(s,3,n)}return typeof e[0]=="string"?{type:"variable",name:e[0]}:e[0]}function G(t){switch(t){default:return 0;case"||":case"??":return 4;case"&&":return 5;case"|":return 6;case"^":return 7;case"&":return 8;case"==":case"!=":case"===":case"!==":return 9;case"in":case"instanceof":case"<":case">":case"<=":case">=":return 10;case"<<":case">>":case">>>":return 11;case"+":case"-":return 12;case"*":case"/":case"%":return 13;case"**":return 14}}function j(t){switch(t.nextType()){case"multi":case"unary":return{type:"unary",operator:t.pop()[1],operand:j(t)};default:return we(t)}}function we(t){let e=xe(t);for(;;){switch(t.nextType()){case"(":{t.pop();const s=[];for(;t.nextType()!==")"&&(s.push(d(t)),t.nextType()===",");)t.pop();y(t.pop(),")"),e={type:"function",name:e,params:s};continue}case".":{t.pop();const s=t.pop();y(s,"word"),e={type:"get",value:{type:"hash",object:e,key:{type:"literal",value:s[1]}}};continue}case"[":{t.pop();const s=d(t);y(t.pop(),"]"),e={type:"get",value:{type:"hash",object:e,key:s}};continue}}break}return e}function xe(t){const e=t.pop();switch(e[0]){case"word":return{type:"get",value:{type:"variable",name:e[1]}};case"number":return{type:"literal",value:Number(e[1])};case"boolean":return{type:"literal",value:e[1]==="true"};case"undefined":return{type:"literal",value:void 0};case"null":return{type:"literal",value:null};case'"':return F(t,"doubleString",e[0]);case"'":return F(t,"singleString",e[0]);case"`":return F(t,"template",e[0]);case"(":{const s=d(t);return y(t.pop(),")"),s}case"[":{const s=[];for(;t.nextType()!=="]";)if(s.push(d(t)),t.nextType()===",")t.pop();else if(t.nextType()==="]"){t.pop();break}else throw Error("']' is required");return{type:"array",values:s}}case"{":{const s=[];for(;t.nextType()!=="}";){const n=Array(2),r=t.pop();if(r[0]==="word"?n[0]={type:"literal",value:r[1]}:r[0]==="["&&(n[0]=d(t),y(t.pop(),"]")),y(t.pop(),":"),n[1]=d(t),s.push(n),t.nextType()===",")t.pop();else if(t.nextType()==="}"){t.pop();break}else throw Error("'}' is required")}return{type:"object",entries:s}}default:throw new Error(JSON.stringify(e))}}function F(t,e,s){const n=[""];let r=0;return t.expand(e,()=>{e:for(;;){n[r]+=t.skip();const i=t.pop();switch(i[0]){case s:break e;case"return":throw Error();case"escape":n[r]+=i[1];continue;case"${":t.expand("script",()=>{n.push(d(t))}),y(t.pop(),"}"),n.push(t.skip()),r+=2}}}),r===0?{type:"literal",value:n[0]}:{type:"join",values:n.filter(i=>i!==""),separator:""}}function y(t,e,s=""){if(!t||t[0]!==e)throw Error(s)}function C(t,e,s=t.length-1){for(let n=s;n>=0;n--)if(e in t[n])return[t[n][e],n];return[void 0,-1]}class U{_key;_value;_index;_entries;_stack;constructor(e,s,n,r,i){this._key=e,this._value=s,this._index=n,this._entries=r,this._stack=i}get key(){return this._key}get value(){return this._value}get index(){return this._index}get size(){return this._entries.length}get isFirst(){return this._index===0}get isLast(){return this._index===this._entries.length-1}get parent(){return C(this._stack,"loop")[0]}}const ke=new DOMParser;function h(t,e="tree"){switch(e){case"tree":if(typeof t=="string"){const s=ke.parseFromString(t,"text/html");return{type:"tree",children:P(s.head).concat(P(s.body))}}else return t.nodeType===11?{type:"tree",children:P(t)}:ee(t);case"text":return J(new M(t,e));case"script":return d(new M(t,e))}}class Pe{node;constructor(e){this.node=e}isSkippable(e){for(let s=this.node;s;s=s.nextSibling)switch(s.nodeType){default:return!1;case 1:return s.hasAttribute(e);case 3:if(!/^\s*$/.test(s.data))return!1}return!1}skip(){for(;;){if(this.node.nodeType===1)return this;this.node=this.node.nextSibling}}pop(){const e=this.node;do this.node=this.node?this.node.nextSibling:null;while(this.node&&this.node.nodeType===1&&this.node.tagName==="SCRIPT");return e}}function P(t){let e=t.firstChild;for(;e&&e.nodeType===1&&e.tagName==="SCRIPT";)e=e.nextSibling;const s=new Pe(t.firstChild),n=[];for(;s.node;)n.push(Te(s));return n}function Te(t){switch(t.node.nodeType){case 3:return h(t.pop().data,"text");case 1:return Q(t);default:return""}}function Se(t){return Q(t)}function Q(t){const e=t.node;if(e.hasAttribute("@for")){const s=e.getAttribute("@each")||void 0,n=h(e.getAttribute("@for"),"script");return{type:"for",each:s,array:n,value:X(t)}}else return X(t)}function X(t){const e=t.node;if(e.hasAttribute("@if")){const s=h(e.getAttribute("@if"),"script"),n=Y(e);t.pop();const r=t.isSkippable("@else")?Se(t.skip()):void 0;return{type:"if",condition:s,truthy:n,falsy:r}}else return Y(t.pop())}function Y(t){if(t.hasAttribute("@expand")){const e=h(t.getAttribute("@expand"),"script"),s=V(t);return{type:"expand",template:e,default:s}}else return V(t)}function V(t){if(t.tagName.toLowerCase()==="group"){const e={type:"group"};return t.hasAttributes()&&t.getAttributeNames().forEach(s=>{s.match(/^@(if|else|for|each|expand)$/)||s.match(/^@.*$/)&&(e.props||(e.props={}),e.props[s]=t.getAttribute(s))}),t.hasChildNodes()&&(e.children=P(t)),e}else return ee(t)}function ee(t){const e={type:"element",tag:t.tagName.toLowerCase()};if(t.hasAttributes()){const s=[];if(t.getAttributeNames().forEach(n=>{const r=t.getAttribute(n);switch(n){case"is":{n in e||(e.is=r);return}case"class":case"part":return(e[n]??(e[n]=[])).push(r.split(/\s+/));case"style":return s.push(r);case"is:":return e.is=h(r,"script");case"class:":case"part:":{const i=n.slice(0,-1);return(e[i]??(e[i]=[])).push({type:"flags",value:h(r,"script")})}case"style:":return s.push(h(r,"script"))}{const i=n.match(/^on(?<type>.+?):?$/);if(i?.groups){const o=i.groups.type,c={type:"handler",value:h(r,"script")};return((e.on??(e.on={}))[o]??(e.on[o]=[])).push(c)}}{const i=n.match(/^(?<name>.+):$/);if(i?.groups)return(e.props??(e.props={}))[i.groups.name]=h(r,"script")}if(!n.match(/^(?<name>.+)\*$/)?.groups&&!n.match(/^@(if|else|for|each|expand)$/)&&!(n in(e.props??(e.props={}))))return e.props[n]=r}),s.length&&(s.length===1&&typeof s[0]=="string"?e.style=s[0]:e.style={type:"join",values:s.filter(n=>n!==""),separator:";"}),e.props){for(const n in e.props){const r=n.match(/^(?<name>.+)&$/);if(r?.groups){const i=r.groups.name;(e.bools??(e.bools={}))[i]=h(e.props[n],"script"),delete e.props[i],delete e.props[n],delete e.props[i+":"]}}Object.keys(e.props).length||delete e.props}}return t.hasChildNodes()&&(e.children=P(t)),e}function v(t){return typeof t=="object"&&"type"in t}function Ce(t,e){switch(t){case"void":return;case"typeof":return typeof e;case"+":return+e;case"-":return-e;case"~":return~e;case"!":return!e;default:throw Error(t+" does not exist")}}function te(t,e,s){switch(t){case"+":return e+s;case"-":return e-s;case"/":return e/s;case"*":return e*s;case"%":return e%s;case"**":return e**s;case"in":return e in s;case"instanceof":return e instanceof s;case"<":return e<s;case">":return e>s;case"<=":return e<=s;case">=":return e>=s;case"==":return e==s;case"!=":return e!=s;case"===":return e===s;case"!==":return e!==s;case"<<":return e<<s;case">>":return e>>s;case">>>":return e>>>s;case"&":return e&s;case"|":return e|s;case"^":return e^s;case"&&":return e&&s;case"||":return e||s;case"??":return e??s;default:throw Error(t+" does not exist")}}function a(t,e=[]){return T[t.type](t,e)}const T={literal:(t,e)=>t.value,array:(t,e)=>t.values.map(s=>a(s,e)),object:(t,e)=>t.entries.map(s=>s.map(n=>a(n,e))).reduce((s,[n,r])=>(s[n]=r,s),{}),variable:(t,e)=>{const[,s]=C(e,t.name);if(s>=0)return[e[s],t.name]},unary:(t,e)=>Ce(t.operator,a(t.operand,e)),binary:(t,e)=>te(t.operator,a(t.left,e),a(t.right,e)),assign:(t,e)=>{const s=a(t.left,e);if(!s)throw Error(t.left?t.left.name:"key is not defined");const[n,r]=s,i=a(t.right,e);return n[r]=t.operator.length>1?te(t.operator.slice(0,-1),n[r],i):i},function:(t,e)=>{if(t.name.type==="get"&&t.name.value.type==="hash"){const s=a(t.name.value,e);if(!s)throw Error(a(t.name.value.key)+" is not defined");const n=s[0][s[1]];if(typeof n=="function")return n.apply(s[0],t.params.map(r=>a(r,e)))}else{const s=a(t.name,e);if(typeof s=="function")return s(...t.params.map(n=>a(n,e)))}throw Error(t.name.toString()+" is not a function")},hash:(t,e)=>[a(t.object,e),a(t.key,e)],get:(t,e)=>{const s=a(t.value,e);return s&&s[0][s[1]]},join:(t,e)=>t.values.reduce((s,n,r)=>{if(v(n)){const i=a(n,e);return s+(r?t.separator:"")+(typeof i=="object"?JSON.stringify(i):i)}else return s+(r?t.separator:"")+n},""),flags:(t,e)=>{const s=a(t.value,e);if(typeof s=="string")return s.split(/\s+/);if(typeof s=="object"){if(Array.isArray(s))return s;if(s)return Object.keys(s).filter(n=>s[n])}return[]},if:(t,e)=>a(t.condition,e)?a(t.truthy,e):t.falsy?a(t.falsy,e):null,for:(t,e)=>{const s=a(t.array,e);let n;if(typeof s=="object"&&s!==null)if(Symbol.iterator in s)if("entries"in s)n=[...s.entries()];else{let r=0;n=[];for(const i of s)n.push([r++,i])}else n=Object.entries(s);else n=[[0,s]];return n.flatMap(([r,i],o)=>{const c=new U(r,i,o,n,e);return K(a(t.value,e.concat([t.each?{[t.each]:i,loop:c}:{loop:c}])))})},element:(t,e)=>{const s=T.tree(t,e);return s.tag=t.tag,t.is&&(s.is=typeof t.is=="string"?t.is:a(t.is,e)),se(t,e,s),s},tree:(t,e)=>{const s=(t.children||[])?.flatMap(n=>typeof n=="string"?[n]:K(a(n,e)));return s.length?{children:s}:{}},expand:(t,e)=>{const s=a(t.template,e);return v(s)?(s.type==="tree"&&(s.type="group"),a(s,e)):a(t.default,e)},group:(t,e)=>t.children?t.children.flatMap(s=>K(v(s)?a(s,e):s)):[],handler:(t,e)=>{t.cache||(t.cache=[]);for(const n of t.cache)if(ne(n[0],e))return n[1];const s=n=>a(t.value,[...e,{event:n}]);return t.cache.push([e,s]),s}};function se(t,e,s){if(t.style&&(s.style=typeof t.style=="string"?t.style:a(t.style,e)),t.bools)for(const n in t.bools){const r=t.bools[n],i=typeof r=="string"?r:a(r,e);i&&((s.props??(s.props={}))[n]=i)}if(t.props){s.props||(s.props={});for(const n in t.props)if(!n.startsWith("@")){const r=t.props[n];s.props[n]=typeof r=="string"?r:a(r,e)}}if(t.class&&t.class.forEach(n=>s.class=(s.class||[]).concat(Array.isArray(n)?n:a(n,e))),t.part&&t.part.forEach(n=>s.part=(s.part||[]).concat(Array.isArray(n)?n:a(n,e))),t.on){s.on||(s.on={});for(const n in t.on)s.on[n]=t.on[n].map(r=>a(r,e))}}function ne(t,e,s=t.length-1,n=e.length-1){const[r,i]=C(t,"loop",s),[o,c]=C(e,"loop",n);return!r&&!o?!0:!r||!o?!1:r.index===o.index&&r.key===o.key&&r.value===o.value&&ne(t,e,i-1,c-1)}function K(t){return t==null?[]:Array.isArray(t)?t:[t]}export{M as Lexer};export{J as innerText,d as expression};export{U as Loop};export{h as parse};export{a as evaluate};const I=L({alert,console,Object,Number,Math,Date,Array,JSON,String,isNaN,isFinite,location,history,navigator});function re(t){const e={};if("tag"in t){const s=e,n=t;if(s.tag=n.tag,"is"in n&&(s.is=n.tag),n.class&&(s.class=n.class.slice()),n.part&&(s.part=n.part.slice()),"style"in n&&(s.style=n.style),n.props&&(s.props={...n.props}),n.on){s.on={};for(const r in n.on)s.on[r]=n.on[r].slice()}}return t.children&&(e.children=t.children.map(s=>typeof s=="object"?re(s):s)),"node"in t&&(e.node=t.node),e}class S{_stack;_component;_el;_tree;_props={};constructor(e,s,n){this._component=e,this._el=s,this._tree=n,this._patch=this._patch.bind(this),this._on=this._on.bind(this),this._off=this._off.bind(this),typeof this._component.stack=="function"?(async()=>{const r=await e.stack(this);this._stack=[I,this._props,...r?Array.isArray(r)?r:[r]:[]],x(r,this._patch),this._patch()})().then():(this._stack=[I,this._props,...this._component.stack],x(this._component.stack,this._patch),this._patch())}setProp(e,s){switch(e){case"is":case"class":case"part":case"style":return;default:{const n=this._props[e];n!==s&&(w(n,this._patch),this._props[e]=s,x(this._props[e],this._patch),this._patch())}}}_unwatch(){w(this._stack,this._patch)}get component(){return this._component}get el(){return this._el}get root(){return this._tree.node}get props(){return this._props}get patch(){return this._patch}get on(){return this._on}get off(){return this._off}_patch(){if(this._stack&&this._tree&&this._component.template){const e=a(this._component.template,this._stack);z(this._tree,e),this._el.dispatchEvent(new CustomEvent("patched",{bubbles:!0,composed:!0,detail:{tree:re(this._tree)}}))}}_on(e,s,n=!1){this._el.addEventListener(e,s,n)}_off(e,s,n=!1){this._el.removeEventListener(e,s,n)}}function N(t){return typeof t=="object"&&t.template&&t.stack}const ie="beako-entity";class A extends HTMLElement{tree;entity;constructor(){super();this.tree=$(this.attachShadow({mode:"open"}))}setProp(e,s){this.entity?.setProp(e,s)}static getComponent(){}loadProps(){this.hasAttributes()&&this.getAttributeNames().forEach(e=>{this.setProp(e,this.getAttribute(e))})}get attributes(){return Ne(super.attributes,this.setProp)}setAttribute(e,s){this.setProp(e,s),super.setAttribute(e,s)}getAttributeNode(e){const s=super.getAttributeNode(e);return s&&oe(s,this.setProp)}removeAttribute(e){return this.setProp(e,void 0),super.removeAttribute(e)}removeAttributeNode(e){return this.setProp(e.name,void 0),super.removeAttributeNode(e)}connectedCallback(){this.dispatchEvent(new CustomEvent("connected",{bubbles:!1}))}disconnectedCallback(){this.dispatchEvent(new CustomEvent("disconnected",{bubbles:!1}))}}class ve extends A{constructor(){super()}setProp(e,s){if(e==="component")switch(typeof s){case"string":{const n=customElements.get(s);if(n&&A.isPrototypeOf(n)){const r=n.getComponent();r&&(this.entity=new S(r,this,this.tree))}break}case"object":if(N(s))this.entity?.component!==s&&(this.entity?._unwatch(),this.entity=new S(s,this,this.tree));else throw Error(s+" is not a component.");break}super.setProp(e,s)}}customElements.define(ie,ve);function oe(t,e){return new Proxy(t,{set(s,n,r){if(e(n,r),n==="value")return s.value=r}})}function Ne(t,e){return new Proxy(t,{get:function(s,n){return n==="length"?s[n]:oe(s[n],e)}})}function b(t){if(v(t))switch(t.type){case"element":(!ce(t)||"is"in t)&&(t.type="custom");case"tree":t.children?.forEach(b);break;case"if":{b(t.truthy),b(t.falsy);break}case"for":{b(t.value);break}}return t}function ce(t){switch(t.tag){case"html":case"base":case"head":case"link":case"meta":case"style":case"title":case"body":case"address":case"article":case"aside":case"footer":case"header":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"main":case"nav":case"section":case"blockquote":case"dd":case"div":case"dl":case"dt":case"figcaption":case"figure":case"hr":case"li":case"ol":case"p":case"pre":case"ul":case"a":case"abbr":case"b":case"bdi":case"bdo":case"br":case"cite":case"code":case"data":case"dfn":case"em":case"i":case"kbd":case"mark":case"q":case"rp":case"rt":case"ruby":case"s":case"samp":case"small":case"span":case"strong":case"sub":case"sup":case"time":case"u":case"var":case"wbr":case"area":case"audio":case"img":case"map":case"track":case"video":case"embed":case"iframe":case"object":case"param":case"picture":case"portal":case"source":case"svg":case"math":case"canvas":case"noscript":case"script":case"del":case"ins":case"caption":case"col":case"colgroup":case"table":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":case"button":case"datalist":case"fieldset":case"form":case"input":case"label":case"legend":case"meter":case"optgroup":case"option":case"output":case"progress":case"select":case"textarea":case"details":case"dialog":case"menu":case"summary":case"slot":case"template":return!0}return!1}T.evaluation=(t,e)=>a(t.template,t.stack?t.stack.concat(e):e),T.custom=(t,e)=>{const s={tag:t.tag};t.is&&(s.is=typeof t.is=="string"?t.is:a(t.is,e));let n;if(t.isForce)n=!0;else if(ce(t)){const r=customElements.get(s.is);n=r!==void 0&&Object.prototype.isPrototypeOf.call(A,r)}else{let r;for(let i=e.length-1;i>=0;i--)if(t.tag in e[i]){r=e[i][t.tag];break}if(N(r))s.tag=ie,s.props={component:r},n=!0;else{const i=customElements.get(t.tag);n=i!==void 0&&Object.prototype.isPrototypeOf.call(A,i)}}if(n){const r=[],i=[],o=(t.children||[])?.flatMap(c=>{if(typeof c!="string"){const p=c;if(p.props){if(p.props["@as"])return i.push([p.props["@as"],p]),[];if(p.props.slot)return[a(c,e)]}}return r.push(c),[]});return r.length&&i.push(["content",{type:"group",children:r}]),i.length&&(s.props||(s.props={}),i.forEach(([c,p])=>{s.props[c]={type:"evaluation",template:p,stack:e}})),o.length&&(s.children=o),se(t,e,s),s}else return T.element(t,e)};function q(t,e=[]){return L({template:b(typeof t=="string"?h(t):t),stack:typeof e=="function"||Array.isArray(e)?e:[e]})}function Oe(t,e,s=[]){const n=N(e)?e:q(e,s);customElements.define(t,class extends A{constructor(){super();if(this.entity=new S(n,this,this.tree),this.innerHTML){const r=a(b(h(this)));for(const i in r.props)this.setProp(i,r.props[i])}else this.loadProps()}static getComponent(){return n}})}function Le(t,e,s=[]){const n=typeof t=="string"?document.querySelector(t):t,r=$(n.attachShadow({mode:"open"})),i=N(e)?e:q(e,s),o=new S(i,n,r),c=h(n);c.type="custom",c.isForce=!0;const p=a(c);for(const f in p.props)o.setProp(f,p.props[f])}export{I as builtin};export{S as Entity};export{A as ComponentElement};export{b as extend};export{q as compact};export{Oe as define};export{Le as hack};
