const u=Symbol("Beako"),l=Symbol("Reactive"),m=Symbol("Array"),g=Symbol("Beako-lock");function E(e,t,s){if(typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e))){const n=e;if(!n[g])if(w(n),s===void 0){const r=n[u][l][1];typeof t=="function"&&r.add(t);for(const o in n){w(n,o,n[u][l][0]);const i=n[o];typeof i=="object"&&i!==null&&(r.size?r.forEach(c=>{(!(u in i)||!i[u][l][1].has(c))&&E(i,c)}):u in i||E(i))}if(Array.isArray(n)){const o=n[u][m].length;if(n.length<o)for(let i=n.length;i<o;i++)w(n,i);n.length=o}}else{const r=typeof s=="function"?["spy",s]:s;Array.isArray(t)?t.forEach(o=>w(n,o,r)):w(n,t,r)}}return e}function w(e,t,s){if(!e[g]){if(!(u in e)){const n=()=>{e[u][l][1].forEach(r=>r())};if(e[u]={[l]:[["bio",n],new Set]},Array.isArray(e)){const r=e[u][m]=e.slice(),o=c=>(n(),c),i=c=>(E(e),n(),c);Object.defineProperties(e,{unshift:{get(){return(...c)=>i(Array.prototype.unshift.call(r,...c))}},push:{get(){return(...c)=>i(Array.prototype.push.call(r,...c))}},splice:{get(){return(c,p,...f)=>i(p===void 0?Array.prototype.splice.call(r,c,r.length-c):Array.prototype.splice.apply(r,[c,p,...f]))}},pop:{get(){return()=>i(Array.prototype.pop.call(r))}},shift:{get(){return()=>i(Array.prototype.shift.call(r))}},sort:{get(){return c=>o(c===void 0?Array.prototype.sort.call(r):Array.prototype.sort.call(r,c))}},reverse:{get(){return()=>o(Array.prototype.reverse.call(r))}},copyWithin:{get(){return(c,p,f)=>o(Array.prototype.copyWithin.call(r,c,p!==void 0?p:0,f!==void 0?f:r.length))}}})}}if(t!==void 0)if(typeof t!="number"&&isNaN(t)){if(t in e[u]||(e[u][t]=[e[t],new Set],Object.defineProperty(e,t,{get(){return this[u][t][0]},set(n){e[u][l][1].forEach(r=>E(n,r)),he(this[u][t],n)}})),s){for(const n of e[u][t][1])if(n[1]===s[1])return;e[u][t][1].add(s)}}else{const n=Object.getOwnPropertyDescriptor(e,t);(!n||"value"in n)&&t in e[u][m]&&Object.defineProperty(e,t,{get(){return this[u][m][t]},set(r){e[u][l][1].forEach(i=>E(r,i));const o=this[u][m][t];this[u][m][t]=r,o!==r&&e[u][l][0][1]()},configurable:!0,enumerable:!0})}}}function he(e,t){const s=e[0];e[0]=t,s!==t&&e[1].forEach(n=>{switch(n[0]){case"bio":n[1]();break;case"bom":e[1].delete(n);case"spy":n[1](t,s);break}})}async function de(e,t){if(!e[g]){const s=Array.isArray(t)?t:[t],n=await Promise.all(s.map(r=>e[r]===void 0?new Promise(o=>{w(e,r,["bom",o])}):e[r]));return s.reduce((r,o,i)=>(r[o]=n[i],r),{})}return{}}function $(e,t,s){if(t!==void 0)u in e&&t in e[u]&&(s?e[u][t][1].forEach(n=>{n[1]===s&&e[u][t][1].delete(n)}):e[u][t][1].clear());else{for(const n in e[u])Object.defineProperty(e,n,{enumerable:!0,configurable:!0,writable:!0,value:e[u][n][0]}),delete e[u][n];Array.isArray(e)&&(delete e.push,delete e.sort,delete e.splice),delete e[u]}}function k(e,t,s){if(typeof e=="object"&&e!==null){const n=e;if(!n[g])if(s===void 0)if(t){const r=t;n[u]&&n[u][l][1].delete(r);for(const o in n)k(n[o],r)}else{for(const r in n)k(n[r]);$(n)}else Array.isArray(t)?t.forEach(r=>$(n,r,s)):$(n,t,s)}return e}function N(e,t){if(typeof e=="object"&&e!==null){const s=e;if(!s[g]){u in s&&s[u][l][1].add(t);for(const n in s)N(s[n],t)}}return e}function j(e){return e[g]=!0,e}function le(e){return delete e[g],e}export{E as watch};export{de as receive};export{k as unwatch};export{N as reach};export{j as lock};export{le as unlock};let B="destroy",D="patch";const F=Object.seal({get destroy(){return B},set destroy(e){if(typeof e=="string"&&e!=="")B=e;else throw Error("Event type must be string")},get patch(){return D},set patch(e){if(typeof e=="string"&&e!=="")D=e;else throw Error("Event type must be string")}});function _(e){const t={node:e};return R(t),t}function ye(e){const t={tag:e.tagName.toLowerCase(),node:e};return ge(t),R(t),t}function ge(e){if(e.node.hasAttributes()){const t={};e.node.getAttributeNames().forEach(s=>{if(s.startsWith("on"))return;const n=e.node.getAttribute(s);switch(s){case"class":case"part":return e[s]=n.split(/\s+/);case"style":case"is":return e[s]=n;default:return t[s]=n}}),Object.keys(t).length&&(e.props=t)}}function R(e){if(e.node.hasChildNodes()){const t=e.node.childNodes;e.children=[];for(let s=0;s<t.length;s++)switch(t[s].nodeType){case 1:if(t[s].tagName==="SCRIPT")break;e.children.push(ye(t[s]));break;case 3:e.children.push(t[s].data);break}}}function M(e){const t={};if("tag"in e){const s=t,n=e;if(s.tag=n.tag,"is"in n&&(s.is=n.tag),n.class&&(s.class=n.class.slice()),n.part&&(s.part=n.part.slice()),"style"in n&&(s.style=n.style),n.props&&(s.props={...n.props}),n.on){s.on={};for(const r in n.on)s.on[r]=n.on[r].slice()}}return e.children&&(t.children=e.children.map(s=>typeof s=="object"?M(s):s)),"node"in e&&(t.node=e.node),t}function A(e){e.children?.forEach(t=>typeof t=="object"&&A(t)),e.node.dispatchEvent(new CustomEvent(F.destroy,{bubbles:!1,detail:{ve:e}}))}function W(e,t){return J(e,t),e.node.dispatchEvent(new CustomEvent(F.patch,{bubbles:!0,composed:!0,detail:{tree:M(e)}})),e}function T(e,t){return e.tag!==t.tag||e.is!==t.is||t.new?T(t.is?{tag:t.tag,is:t.is,node:document.createElement(t.tag,{is:t.is})}:{tag:t.tag,node:document.createElement(t.tag)},t):(be(e,t),me(e,t),Ee(e,t),we(e,t),Ae(e,t),J(e,t),xe(e,t),"key"in t?e.key=t.key:delete e.key,e)}function be(e,t){const s=(e.class||[]).join(" "),n=(t.class||[]).join(" ");s!==n&&(e.node.className=n),n.length?e.class=(t.class||[]).slice():delete e.class}function me(e,t){const s=e.part||[],n=t.part||[],r=n.filter(i=>!s.includes(i));r.length&&e.node.part.add(...r);const o=s.filter(i=>!n.includes(i));o.length&&e.node.part.remove(...o),n.length?e.part=n.slice():delete e.part}function Ee(e,t){if(e.node instanceof HTMLElement){const s=e.style||"",n=t.style||"";s!=n&&(e.node.style.cssText=n,n!=""?e.style=n:delete e.style)}}function we(e,t){const s=e.props||{},n=t.props||{},r=Object.keys(s),o=Object.keys(n);o.filter(i=>!r.includes(i)||s[i]!==n[i]).forEach(i=>e.node.setAttribute(i,n[i])),r.filter(i=>!o.includes(i)).forEach(i=>e.node.removeAttribute(i)),o.length?e.props={...n}:delete e.props}function Ae(e,t){const s=e.on||{},n=t.on||{},r=Object.keys(s),o=Object.keys(n);o.filter(i=>!r.includes(i)).forEach(i=>{n[i].forEach(c=>{e.node.addEventListener(i,c)})}),r.filter(i=>!o.includes(i)).forEach(i=>{s[i].forEach(c=>{e.node.removeEventListener(i,c)})}),o.filter(i=>r.includes(i)).forEach(i=>{const c=n[i],p=s[i];c.filter(f=>!p.includes(f)).forEach(f=>e.node.addEventListener(i,f)),p.filter(f=>!c.includes(f)).forEach(f=>e.node.removeEventListener(i,f))}),o.length?e.on=o.reduce((i,c)=>(i[c]=[...n[c]],i),{}):delete e.on}function xe(e,t){if(Object.prototype.isPrototypeOf.call(HTMLInputElement.prototype,e.node)){const s=e.node;s.value!==t.props?.value&&(t.props&&"value"in t.props?s.value!==t.props?.value.toString()&&(s.value=t.props.value):e.node.value!==""&&(e.node.value="")),!s.checked&&t.props&&"checked"in t.props?s.checked=!0:s.checked&&!(t.props&&"checked"in t.props)&&(s.checked=!1)}if(Object.prototype.isPrototypeOf.call(HTMLOptionElement.prototype,e.node)){const s=e.node;!s.selected&&t.props&&"selected"in t.props?s.selected=!0:s.selected&&!(t.props&&"selected"in t.props)&&(s.selected=!1)}}class ke{index=0;node;parent;children;stock;constructor(t){this.stock=new Map,this.parent=t,this.node=t.node.firstChild,this.children=t.children||[]}get isEnd(){return this.index>=this.children.length}get vNode(){return this.children[this.index]}next(t=1){typeof this.children[this.index]=="number"?this.index+=t:this.node&&(this.index+=t,this.node=this.node.nextSibling)}prev(){typeof this.children[this.index]=="number"?this.index--:this.node?(this.index--,this.node=this.node.previousSibling):(this.node=this.parent.node.lastChild,this.node&&this.index--)}add(t){const s=typeof t=="string"?document.createTextNode(t):t.node,n=this.node;return this.node=this.parent.node.insertBefore(s,this.node||null),this.next(n?0:1),t}replace(t){if(typeof t=="string"&&this.node?.nodeType===3)this.node.data!==t&&(this.node.data=t);else{const s=typeof t=="string"?document.createTextNode(t):t.node;this.node!==s&&(typeof this.vNode=="object"&&("key"in this.vNode?this.stock.set(this.vNode.key,this.vNode):this.node?.nodeType===1&&A(this.vNode)),this.parent.node.replaceChild(s,this.node),this.node=s)}return this.next(),t}remove(){typeof this.vNode=="object"&&("key"in this.vNode&&this.stock.set(this.vNode.key,this.vNode),this.node?.nodeType===1&&A(this.vNode));const t=this.node;this.node=t?.nextSibling||null,this.parent.node.removeChild(t)}removeAll(){if(this.node)for(let t=this.node;t!==null;t=t.nextSibling)this.parent.node.removeChild(t);for(;!this.isEnd;)typeof this.vNode=="object"&&A(this.vNode),this.index++}has(t){return this.stock.has(t)}addFromKey(t,s){const n=this.stock.get(t);return this.stock.delete(t),this.add(T(n,s))}clear(){this.stock.forEach(t=>A(t)),this.stock.clear()}search(t){if(this.isEnd)return!1;const s=t();if(typeof s=="boolean")return s;{this.next();const n=this.search(t);return this.prev(),n&&(this.remove(),this.index++),n}}}function J(e,t){const s=t.children||[],n=new ke(e),r=s.filter(c=>typeof c=="number").reverse();let o=r.pop();const i=s.map(c=>{switch(typeof c){case"string":return!n.isEnd&&typeof n.vNode=="string"?n.replace(c):n.add(c);case"object":{if("key"in c){if(n.has(c.key))return n.addFromKey(c.key,c);if(typeof n.vNode=="object"&&n.search(()=>{if(typeof n.vNode=="object"&&c.key===n.vNode.key)return!0;if(typeof n.vNode=="number"&&o!=null&&n.vNode===o)return!1}))return n.replace(T(n.vNode,c))}if(typeof n.vNode=="object"){const p="key"in n.vNode?{tag:c.tag,node:document.createElement(c.tag)}:n.vNode;return n.replace(T(p,c))}else return n.add(T({tag:c.tag,node:document.createElement(c.tag)},c))}case"number":{const p=n.search(()=>{if(typeof n.vNode=="number"&&c===n.vNode)return!0});return o=r.pop(),p&&n.next(),n.clear(),c}}});n.removeAll(),i.length?e.children=i:delete e.children}function Z(e,t){for(const s of e.children||[])if(typeof s=="object"){if(t(s))return s;{const n=Z(s,t);if(n)return n}}return null}function G(e,t){e.children?.forEach(s=>{typeof s=="object"&&(t(s),G(s,t))})}export{F as eventTypes};export{_ as load};export{W as patch};export{Z as find};export{G as trace};export{M as clone};export{A as destroy};class K{text;field;index;token;constructor(t,s,n=0,r=null){this.text=t,this.field=s,this.index=n,this.token=r}_next(t){const s=["",""];for(this.index=t;this.index<this.text.length;this.index++){const n=U(this.field,s[1]+this.text[this.index]);if(n==="other")return s;s[0]=n,s[1]=s[1]+this.text[this.index]}return s}skip(){let t="";if(!this.token)for(let s=this.index;s<this.text.length;s++)if(U(this.field,this.text[s])==="other")t+=this.text[s];else if(this.token=this._next(s),this.token&&this.token[0]==="partial")t+=this.token[1],this.token=null;else return t;return t}nextType(){return this.skip(),this.token?this.token[0]:""}pop(){this.skip();const t=this.token;return this.token=null,t||null}expand(t,s){const n=this.field;this.field=t,s(),this.token&&(this.index-=this.token[1].length,this.token=null),this.field=n}}function U(e,t){switch(e){case"script":switch(t){case"+":case"-":return"multi";case"void":case"typeof":case"~":case"!":return"unary";case"/":case"*":case"%":case"**":case"in":case"instanceof":case"<":case">":case"<=":case">=":case"==":case"!=":case"===":case"!==":case"<<":case">>":case">>>":case"&":case"|":case"^":case"&&":case"||":case"??":return"binary";case"=":case"*=":case"**=":case"/=":case"%=":case"+=":case"-=":case"<<=":case">>=":case">>>=":case"&=":case"^=":case"|=":case"&&=":case"||=":case"??=":return"assign";case"++":case"--":return"crement";case"false":case"true":return"boolean";case"null":case"undefined":case".":case"?.":case"[":case"]":case"{":case"}":case"(":case")":case"...":case"?":case":":case",":case"'":case'"':case"`":return t}switch(!0){case/^\/\/.*$/.test(t):return"lineComment";case/^[_\$a-zA-Z][_\$a-zA-Z0-9]*$/.test(t):return"word";case/^\d+\.?\d*$|^\.?\d+$/.test(t):return"number"}break;case"template":switch(t){case"$":return"partial";case"${":return t;case"}":return t;case"`":return"`";case"\r":case`
`:case`\r
`:return"other"}case"singleString":case"doubleString":switch(t){case"\\":return"partial";case"\r":case`
`:case`\r
`:return"return";case`\\\r
`:return"escape";case"'":if(e==="singleString")return t;break;case'"':if(e==="doubleString")return t;break}switch(!0){case/^\\(x|u)$/.test(t):return"partial";case/^\\.$/.test(t):return"escape"}break;case"text":switch(t){case"{":case"}":return"partial";case"{{":case"}}":return t}break}return"other"}function Q(e){const t=[];for(t.push(e.skip());e.nextType();)e.nextType()==="{{"?(e.pop(),e.expand("script",()=>{t.push(d(e))}),y(e.pop(),"}}"),t.push(e.skip())):e.pop();const s=t.filter(n=>n!=="");return s.length===1&&typeof s[0]=="string"?s[0]:{type:"join",values:s,separator:""}}function d(e){return _e(e)}function _e(e){const t=Te(e);if(e.nextType()==="assign"){if(t.type!=="get")throw Error("The left operand is not variable");const s=e.pop()[1],n=d(e);return{type:"assign",operator:s,left:t.value,right:n}}else return t}function Te(e){let t=X(e);for(;e.nextType()==="?";){e.pop();const s=d(e);y(e.pop(),":");const n=X(e);t={type:"if",condition:t,truthy:s,falsy:n}}return t}function X(e){const t=new Array;for(t.push(I(e));e.nextType()==="multi"||e.nextType()==="binary";)t.push(e.pop()[1]),t.push(I(e));for(;t.length>1;)for(let s=0;s+1<t.length;s+=2)if(s+3>=t.length||Y(t[s+1])>Y(t[s+3])){const n={type:"binary",operator:t[s+1],left:t[s],right:t[s+2]};t.splice(s,3,n)}return typeof t[0]=="string"?{type:"variable",name:t[0]}:t[0]}function Y(e){switch(e){default:return 0;case"||":case"??":return 4;case"&&":return 5;case"|":return 6;case"^":return 7;case"&":return 8;case"==":case"!=":case"===":case"!==":return 9;case"in":case"instanceof":case"<":case">":case"<=":case">=":return 10;case"<<":case">>":case">>>":return 11;case"+":case"-":return 12;case"*":case"/":case"%":return 13;case"**":return 14}}function I(e){switch(e.nextType()){case"multi":case"unary":return{type:"unary",operator:e.pop()[1],operand:I(e)};default:return Pe(e)}}function Pe(e){let t=Se(e);for(;;){switch(e.nextType()){case"(":{e.pop();const s=[];for(;e.nextType()!==")"&&(s.push(d(e)),e.nextType()===",");)e.pop();y(e.pop(),")"),t={type:"function",name:t,params:s};continue}case".":{e.pop();const s=e.pop();y(s,"word"),t={type:"get",value:{type:"hash",object:t,key:{type:"literal",value:s[1]}}};continue}case"[":{e.pop();const s=d(e);y(e.pop(),"]"),t={type:"get",value:{type:"hash",object:t,key:s}};continue}}break}return t}function Se(e){const t=e.pop();switch(t[0]){case"word":return{type:"get",value:{type:"variable",name:t[1]}};case"number":return{type:"literal",value:Number(t[1])};case"boolean":return{type:"literal",value:t[1]==="true"};case"undefined":return{type:"literal",value:void 0};case"null":return{type:"literal",value:null};case'"':return q(e,"doubleString",t[0]);case"'":return q(e,"singleString",t[0]);case"`":return q(e,"template",t[0]);case"(":{const s=d(e);return y(e.pop(),")"),s}case"[":{const s=[];for(;e.nextType()!=="]";)if(s.push(d(e)),e.nextType()===",")e.pop();else if(e.nextType()==="]"){e.pop();break}else throw Error("']' is required");return{type:"array",values:s}}case"{":{const s=[];for(;e.nextType()!=="}";){const n=Array(2),r=e.pop();if(r[0]==="word"?n[0]={type:"literal",value:r[1]}:r[0]==="["&&(n[0]=d(e),y(e.pop(),"]")),y(e.pop(),":"),n[1]=d(e),s.push(n),e.nextType()===",")e.pop();else if(e.nextType()==="}"){e.pop();break}else throw Error("'}' is required")}return{type:"object",entries:s}}default:throw new Error(JSON.stringify(t))}}function q(e,t,s){const n=[""];let r=0;return e.expand(t,()=>{e:for(;;){n[r]+=e.skip();const o=e.pop();switch(o[0]){case s:break e;case"return":throw Error();case"escape":n[r]+=o[1];continue;case"${":e.expand("script",()=>{n.push(d(e))}),y(e.pop(),"}"),n.push(e.skip()),r+=2}}}),r===0?{type:"literal",value:n[0]}:{type:"join",values:n.filter(o=>o!==""),separator:""}}function y(e,t,s=""){if(!e||e[0]!==t)throw Error(s)}function O(e,t,s=e.length-1){for(let n=s;n>=0;n--)if(t in e[n])return[e[n][t],n];return[void 0,-1]}class V{_key;_value;_index;_entries;_stack;constructor(t,s,n,r,o){this._key=t,this._value=s,this._index=n,this._entries=r,this._stack=o}get key(){return this._key}get value(){return this._value}get index(){return this._index}get size(){return this._entries.length}get isFirst(){return this._index===0}get isLast(){return this._index===this._entries.length-1}get parent(){return O(this._stack,"loop")[0]}}const ve=new DOMParser;function h(e,t="tree"){switch(t){case"tree":if(typeof e=="string"){const s=ve.parseFromString(e,"text/html");return{type:"tree",children:P(s.head).concat(P(s.body))}}else return e.nodeType===11?{type:"tree",children:P(e)}:re(e);case"text":return Q(new K(e,t));case"script":return d(new K(e,t))}}class Ne{node;constructor(t){this.node=t}isSkippable(t){for(let s=this.node;s;s=s.nextSibling)switch(s.nodeType){default:return!1;case 1:return s.hasAttribute(t);case 3:if(!/^\s*$/.test(s.data))return!1}return!1}skip(){for(;;){if(this.node.nodeType===1)return this;this.node=this.node.nextSibling}}pop(){const t=this.node;do this.node=this.node?this.node.nextSibling:null;while(this.node&&this.node.nodeType===1&&this.node.tagName==="SCRIPT");return t}}function P(e){let t=e.firstChild;for(;t&&t.nodeType===1&&t.tagName==="SCRIPT";)t=t.nextSibling;const s=new Ne(e.firstChild),n=[];for(;s.node;)n.push(Oe(s));return n}function Oe(e){switch(e.node.nodeType){case 3:return h(e.pop().data,"text");case 1:return ee(e);default:return""}}function Ce(e){return ee(e)}function ee(e){const t=e.node;if(t.hasAttribute("@for")){const s=t.getAttribute("@each")||void 0,n=h(t.getAttribute("@for"),"script");return{type:"for",each:s,array:n,value:te(e)}}else return te(e)}function te(e){const t=e.node;if(t.hasAttribute("@if")){const s=h(t.getAttribute("@if"),"script"),n=se(t);e.pop();const r=e.isSkippable("@else")?Ce(e.skip()):void 0;return{type:"if",condition:s,truthy:n,falsy:r}}else return se(e.pop())}function se(e){if(e.hasAttribute("@expand")){const t=h(e.getAttribute("@expand"),"script"),s=ne(e);return{type:"expand",template:t,default:s}}else return ne(e)}function ne(e){if(e.tagName.toLowerCase()==="group"){const t={type:"group"};return e.hasAttributes()&&e.getAttributeNames().forEach(s=>{s.match(/^@(if|else|for|each|expand)$/)||s.match(/^@.*$/)&&(t.props||(t.props={}),t.props[s]=e.getAttribute(s))}),e.hasChildNodes()&&(t.children=P(e)),t}else return re(e)}function re(e){const t={type:"element",tag:e.tagName.toLowerCase()};if(e.hasAttributes()){const s=[];if(e.getAttributeNames().forEach(n=>{const r=e.getAttribute(n);switch(n){case"is":{n in t||(t.is=r);return}case"class":case"part":return(t[n]??(t[n]=[])).push(r.split(/\s+/));case"style":return s.push(r);case"is:":return t.is=h(r,"script");case"class:":case"part:":{const o=n.slice(0,-1);return(t[o]??(t[o]=[])).push({type:"flags",value:h(r,"script")})}case"style:":return s.push(h(r,"script"))}{const o=n.match(/^on(?<type>.+?):?$/);if(o?.groups){const i=o.groups.type,c={type:"handler",value:h(r,"script")};return((t.on??(t.on={}))[i]??(t.on[i]=[])).push(c)}}{const o=n.match(/^(?<name>.+):$/);if(o?.groups)return(t.props??(t.props={}))[o.groups.name]=h(r,"script")}if(!n.match(/^(?<name>.+)\*$/)?.groups&&!n.match(/^@(if|else|for|each|expand)$/)&&!(n in(t.props??(t.props={}))))return t.props[n]=r}),s.length&&(s.length===1&&typeof s[0]=="string"?t.style=s[0]:t.style={type:"join",values:s.filter(n=>n!==""),separator:";"}),t.props){for(const n in t.props){const r=n.match(/^(?<name>.+)&$/);if(r?.groups){const o=r.groups.name;(t.bools??(t.bools={}))[o]=h(t.props[n],"script"),delete t.props[o],delete t.props[n],delete t.props[o+":"]}}Object.keys(t.props).length||delete t.props}}return e.hasChildNodes()&&(t.children=P(e)),t}function C(e){return typeof e=="object"&&"type"in e}function Le(e,t){switch(e){case"void":return;case"typeof":return typeof t;case"+":return+t;case"-":return-t;case"~":return~t;case"!":return!t;default:throw Error(e+" does not exist")}}function oe(e,t,s){switch(e){case"+":return t+s;case"-":return t-s;case"/":return t/s;case"*":return t*s;case"%":return t%s;case"**":return t**s;case"in":return t in s;case"instanceof":return t instanceof s;case"<":return t<s;case">":return t>s;case"<=":return t<=s;case">=":return t>=s;case"==":return t==s;case"!=":return t!=s;case"===":return t===s;case"!==":return t!==s;case"<<":return t<<s;case">>":return t>>s;case">>>":return t>>>s;case"&":return t&s;case"|":return t|s;case"^":return t^s;case"&&":return t&&s;case"||":return t||s;case"??":return t??s;default:throw Error(e+" does not exist")}}function a(e,t=[]){return S[e.type](e,t)}const S={literal:(e,t)=>e.value,array:(e,t)=>e.values.map(s=>a(s,t)),object:(e,t)=>e.entries.map(s=>s.map(n=>a(n,t))).reduce((s,[n,r])=>(s[n]=r,s),{}),variable:(e,t)=>{const[,s]=O(t,e.name);if(s>=0)return[t[s],e.name]},unary:(e,t)=>Le(e.operator,a(e.operand,t)),binary:(e,t)=>oe(e.operator,a(e.left,t),a(e.right,t)),assign:(e,t)=>{const s=a(e.left,t);if(!s)throw Error(e.left?e.left.name:"key is not defined");const[n,r]=s,o=a(e.right,t);return n[r]=e.operator.length>1?oe(e.operator.slice(0,-1),n[r],o):o},function:(e,t)=>{if(e.name.type==="get"&&e.name.value.type==="hash"){const s=a(e.name.value,t);if(!s)throw Error(a(e.name.value.key)+" is not defined");const n=s[0][s[1]];if(typeof n=="function")return n.apply(s[0],e.params.map(r=>a(r,t)))}else{const s=a(e.name,t);if(typeof s=="function")return s(...e.params.map(n=>a(n,t)))}throw Error(e.name.toString()+" is not a function")},hash:(e,t)=>[a(e.object,t),a(e.key,t)],get:(e,t)=>{const s=a(e.value,t);return s&&s[0][s[1]]},join:(e,t)=>e.values.reduce((s,n,r)=>{if(C(n)){const o=a(n,t);return s+(r?e.separator:"")+(typeof o=="object"?JSON.stringify(o):o)}else return s+(r?e.separator:"")+n},""),flags:(e,t)=>{const s=a(e.value,t);if(typeof s=="string")return s.split(/\s+/);if(typeof s=="object"){if(Array.isArray(s))return s;if(s)return Object.keys(s).filter(n=>s[n])}return[]},if:(e,t)=>a(e.condition,t)?a(e.truthy,t):e.falsy?a(e.falsy,t):null,for:(e,t)=>{const s=a(e.array,t);let n;if(typeof s=="object"&&s!==null)if(Symbol.iterator in s)if("entries"in s)n=[...s.entries()];else{let r=0;n=[];for(const o of s)n.push([r++,o])}else n=Object.entries(s);else n=[[0,s]];return n.flatMap(([r,o],i)=>{const c=new V(r,o,i,n,t);return H(a(e.value,t.concat([e.each?{[e.each]:o,loop:c}:{loop:c}])))})},element:(e,t)=>{const s=S.tree(e,t);return s.tag=e.tag,e.is&&(s.is=typeof e.is=="string"?e.is:a(e.is,t)),ie(e,t,s),s},tree:(e,t)=>{const s=(e.children||[])?.flatMap(n=>typeof n=="string"?[n]:H(a(n,t)));return s.length?{children:s}:{}},expand:(e,t)=>{const s=a(e.template,t);return C(s)?(s.type==="tree"&&(s.type="group"),a(s,t)):a(e.default,t)},group:(e,t)=>e.children?e.children.flatMap(s=>H(C(s)?a(s,t):s)):[],handler:(e,t)=>{e.cache||(e.cache=[]);for(const n of e.cache)if(ce(n[0],t))return n[1];const s=n=>a(e.value,[...t,{event:n}]);return e.cache.push([t,s]),s}};function ie(e,t,s){if(e.style&&(s.style=typeof e.style=="string"?e.style:a(e.style,t)),e.bools)for(const n in e.bools){const r=e.bools[n],o=typeof r=="string"?r:a(r,t);o&&((s.props??(s.props={}))[n]=o)}if(e.props){s.props||(s.props={});for(const n in e.props)if(!n.startsWith("@")){const r=e.props[n];s.props[n]=typeof r=="string"?r:a(r,t)}}if(e.class&&e.class.forEach(n=>s.class=(s.class||[]).concat(Array.isArray(n)?n:a(n,t))),e.part&&e.part.forEach(n=>s.part=(s.part||[]).concat(Array.isArray(n)?n:a(n,t))),e.on){s.on||(s.on={});for(const n in e.on)s.on[n]=e.on[n].map(r=>a(r,t))}}function ce(e,t,s=e.length-1,n=t.length-1){const[r,o]=O(e,"loop",s),[i,c]=O(t,"loop",n);return!r&&!i?!0:!r||!i?!1:r.index===i.index&&r.key===i.key&&r.value===i.value&&ce(e,t,o-1,c-1)}function H(e){return e==null?[]:Array.isArray(e)?e:[e]}export{K as Lexer};export{Q as innerText,d as expression};export{V as Loop};export{h as parse};export{a as evaluate};const ae=j({alert,console,Object,Number,Math,Date,Array,JSON,String,isNaN,isFinite,location,history,navigator});class v{_stack;_component;_el;_tree;_props={};constructor(t,s,n){this._component=t,this._el=s,this._tree=n,this.patch=this.patch.bind(this),this.on=this.on.bind(this),this.off=this.off.bind(this);const r=o=>{this._stack=[ae,this._props,...o],N(o,this.patch),this.patch(),o.forEach(i=>{if(typeof i=="object"&&i!==null){for(const c in i)if(typeof i[c]=="function"&&isNaN(c)&&!(c in this._el)){const p=i[c].bind(this);Object.defineProperty(this._el,c,{get(){return p}})}}})};if(typeof this._component.data=="function"){const o=this._component.data(this);o instanceof Promise?(async()=>{const i=await o;r(i?Array.isArray(i)?i:[i]:[])})().then():r(o?Array.isArray(o)?o:[o]:[])}else{const o=this._component.data;r(o)}}setProp(t,s){switch(t){case"is":case"class":case"part":case"style":return;default:{const n=this._props[t];n!==s&&(k(n,this.patch),this._props[t]=s,N(this._props[t],this.patch),this.patch())}}}_unwatch(){k(this._stack,this.patch)}get component(){return this._component}get node(){return this._el}get root(){return this._tree.node}get props(){return this._props}patch(){if(this._stack&&this._tree&&this._component.template){const t=a(this._component.template,this._stack);W(this._tree,t)}}on(t,s,n=!1){this._el.addEventListener(t,s,n)}off(t,s,n=!1){this._el.removeEventListener(t,s,n)}}function L(e){return typeof e=="object"&&e.template&&e.data&&e.options}const ue="beako-entity";class x extends HTMLElement{entity;constructor(){super()}setProp(t,s){this.entity?.setProp(t,s)}static getComponent(){}loadProps(){this.hasAttributes()&&this.getAttributeNames().forEach(t=>{this.setProp(t,this.getAttribute(t))})}get attributes(){return je(super.attributes,this.setProp)}setAttribute(t,s){this.setProp(t,s),super.setAttribute(t,s)}getAttributeNode(t){const s=super.getAttributeNode(t);return s&&pe(s,this.setProp)}removeAttribute(t){return this.setProp(t,void 0),super.removeAttribute(t)}removeAttributeNode(t){return this.setProp(t.name,void 0),super.removeAttributeNode(t)}}class $e extends x{constructor(){super()}setProp(t,s){if(t==="component")switch(typeof s){case"string":{const n=customElements.get(s);if(n&&x.isPrototypeOf(n)){const r=n.getComponent();if(r){const o=_(this.attachShadow({mode:r.options.mode,delegatesFocus:r.options.delegatesFocus}));this.entity=new v(r,this,o)}}else throw Error(s+" is not a component.");break}case"object":if(L(s)){const n=_(this.attachShadow({mode:s.options.mode,delegatesFocus:s.options.delegatesFocus}));this.entity=new v(s,this,n)}else throw Error("The object is not a component.");break}super.setProp(t,s)}}customElements.define(ue,$e);function pe(e,t){return new Proxy(e,{set(s,n,r){if(t(n,r),n==="value")return s.value=r}})}function je(e,t){return new Proxy(e,{get:function(s,n){return n==="length"?s[n]:pe(s[n],t)}})}function b(e){if(C(e))switch(e.type){case"element":(!fe(e)||"is"in e)&&(e.type="custom");case"tree":e.children?.forEach(b);break;case"if":{b(e.truthy),b(e.falsy);break}case"for":{b(e.value);break}}return e}function fe(e){switch(e.tag){case"html":case"base":case"head":case"link":case"meta":case"style":case"title":case"body":case"address":case"article":case"aside":case"footer":case"header":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"main":case"nav":case"section":case"blockquote":case"dd":case"div":case"dl":case"dt":case"figcaption":case"figure":case"hr":case"li":case"ol":case"p":case"pre":case"ul":case"a":case"abbr":case"b":case"bdi":case"bdo":case"br":case"cite":case"code":case"data":case"dfn":case"em":case"i":case"kbd":case"mark":case"q":case"rp":case"rt":case"ruby":case"s":case"samp":case"small":case"span":case"strong":case"sub":case"sup":case"time":case"u":case"var":case"wbr":case"area":case"audio":case"img":case"map":case"track":case"video":case"embed":case"iframe":case"object":case"param":case"picture":case"portal":case"source":case"svg":case"math":case"canvas":case"noscript":case"script":case"del":case"ins":case"caption":case"col":case"colgroup":case"table":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":case"button":case"datalist":case"fieldset":case"form":case"input":case"label":case"legend":case"meter":case"optgroup":case"option":case"output":case"progress":case"select":case"textarea":case"details":case"dialog":case"menu":case"summary":case"slot":case"template":return!0}return!1}S.evaluation=(e,t)=>a(e.template,e.stack?e.stack.concat(t):t),S.custom=(e,t)=>{const s={tag:e.tag};e.is&&(s.is=typeof e.is=="string"?e.is:a(e.is,t));let n;if(e.isForce)n=!0;else if(fe(e)){const r=customElements.get(s.is);n=r!==void 0&&Object.prototype.isPrototypeOf.call(x,r)}else{let r;for(let o=t.length-1;o>=0;o--)if(e.tag in t[o]){r=t[o][e.tag];break}if(L(r))s.tag=ue,s.props={component:r},n=!0;else{const o=customElements.get(e.tag);n=o!==void 0&&Object.prototype.isPrototypeOf.call(x,o)}}if(n){const r=[],o=[],i=(e.children||[])?.flatMap(c=>{if(typeof c!="string"){const p=c;if(p.props){if(p.props["@as"])return o.push([p.props["@as"],p]),[];if(p.props.slot)return[a(c,t)]}}return r.push(c),[]});return r.length&&o.push(["content",{type:"group",children:r}]),o.length&&(s.props||(s.props={}),o.forEach(([c,p])=>{s.props[c]={type:"evaluation",template:p,stack:t}})),i.length&&(s.children=i),ie(e,t,s),e.cache&&e.cache!==s.props?.component&&(s.new=!0),s.props?.component?e.cache=s.props.component:delete e.cache,s}else return S.element(e,t)};function z(e,t=[]){return j({template:b(typeof e=="string"?h(e):e),data:typeof t=="function"||Array.isArray(t)?t:[t],options:{mode:"open",delegatesFocus:!0}})}function Fe(e,t,s=[]){const n=L(t)?t:z(t,s);if(n.options.localeOnly)throw Error("This componet is local only.");customElements.define(e,class extends x{constructor(){super();const r=_(this.attachShadow({mode:n.options.mode,delegatesFocus:n.options.delegatesFocus}));if(this.entity=new v(n,this,r),this.innerHTML){const o=a(b(h(this)));for(const i in o.props)this.setProp(i,o.props[i])}else this.loadProps()}static getComponent(){return n}})}function Me(e,t,s=[]){const n=typeof e=="string"?document.querySelector(e):e,r=L(t)?t:z(t,s);if(r.options.localeOnly)throw Error("This componet is local only.");const o=_(n.attachShadow({mode:r.options.mode,delegatesFocus:r.options.delegatesFocus})),i=new v(r,n,o),c=h(n);c.type="custom",c.isForce=!0;const p=a(c);for(const f in p.props)i.setProp(f,p.props[f])}export{ae as builtin};export{v as Entity};export{x as ComponentElement};export{b as extend};export{z as compact};export{Fe as define};export{Me as hack};
